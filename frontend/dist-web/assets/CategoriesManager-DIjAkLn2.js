import{r as a,j as e}from"./index-DLBiUv4k.js";import"./vendor-BtP0CW_r.js";const V=({token:l,apiBase:c,role:n})=>{const[o,F]=a.useState([]),[$,u]=a.useState(1),[g,T]=a.useState(10),[D,I]=a.useState(0),[h,R]=a.useState(""),[p,U]=a.useState("-created_at"),[E,i]=a.useState(null),[W,x]=a.useState(!1),[b,y]=a.useState(""),[j,f]=a.useState(""),[k,v]=a.useState(!0),[d,N]=a.useState(null),[A,z]=a.useState(null),[w,Z]=a.useState({}),[M,P]=a.useState(!1),S=t=>({...t?{Authorization:`Bearer ${t}`}:{}}),C=async()=>{i(null),P(!0);try{const t=new URLSearchParams({page:String($),page_size:String(g)});h&&t.set("search",h),p&&t.set("ordering",p);const s=await fetch(`${c}/products/categories/?${t.toString()}`,{headers:S(l)}),r=await s.json();if(!s.ok)throw new Error(r.detail||"No se pudieron cargar categorías");F(Array.isArray(r.results)?r.results:[]),I(Number(r.count||0))}catch(t){i({type:"error",text:t.message})}finally{P(!1)}};a.useEffect(()=>{l&&C()},[l,$,g,h,p]);const L=()=>{const t={};if(/^[A-Za-z0-9ÁÉÍÓÚáéíóúÑñ\-\s]{1,100}$/.test(b)||(t.name="Nombre requerido, máx 100 y sin caracteres inválidos."),j.length>500&&(t.description="Descripción máximo 500 caracteres."),d){const r=["image/jpeg","image/png","image/webp"].includes(d.type),m=d.size<=5*1024*1024;r||(t.image="Formato de imagen inválido (jpeg, png, webp)."),m||(t.image="Imagen supera 5MB.")}return Z(t),Object.keys(t).length===0},q=async t=>{if(t.preventDefault(),i(null),!!L())try{const s=new FormData;s.append("name",b),s.append("description",j),s.append("active",k?"true":"false"),d&&s.append("image",d);const r=await fetch(`${c}/products/categories/`,{method:"POST",headers:S(l),body:s}),m=await r.json();if(!r.ok)throw new Error(m.detail||"No se pudo crear la categoría");i({type:"success",text:"Categoría creada"}),x(!1),y(""),f(""),v(!0),N(null),C()}catch(s){i({type:"error",text:s.message})}},O=t=>{z(t),y(t.name||""),f(t.description||""),v(!!t.active),N(null),x(!0)},H=async t=>{if(t.preventDefault(),i(null),!!L())try{const s=new FormData;s.append("name",b),s.append("description",j),s.append("active",k?"true":"false"),d&&s.append("image",d);const r=await fetch(`${c}/products/categories/${A.id}/`,{method:"PATCH",headers:S(l),body:s}),m=await r.json();if(!r.ok)throw new Error(m.detail||"No se pudo actualizar la categoría");i({type:"success",text:"Categoría actualizada"}),x(!1),z(null),y(""),f(""),v(!0),N(null),C()}catch(s){i({type:"error",text:s.message})}},G=async t=>{i(null);try{const s=await fetch(`${c}/products/categories/${t}/`,{method:"DELETE",headers:S(l)});if(!s.ok){const r=await s.json();throw new Error(r.detail||"No se pudo eliminar")}i({type:"success",text:"Categoría eliminada"}),C()}catch(s){i({type:"error",text:s.message})}},J=t=>t?t.startsWith("http://")||t.startsWith("https://")?t:t.startsWith("/")?`${c}${t}`:t.startsWith("media/")?`${c}/${t}`:`${c}/media/${t}`:"",_=a.useMemo(()=>Math.max(1,Math.ceil(D/g)),[D,g]);return e.jsxs("div",{className:"space-y-6 relative",children:[M&&e.jsx("div",{className:"absolute inset-0 z-50 bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"bg-gray-800/80 border border-white/10 rounded-xl p-6 shadow-xl text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"mt-3 text-white font-medium",children:"Cargando datos..."}),e.jsx("div",{className:"text-xs text-gray-300",children:"Por favor espera"})]})}),E&&e.jsx("div",{className:`p-3 rounded text-sm ${E.type==="success"?"bg-green-600/20 text-green-200 border border-green-500/40":"bg-red-600/20 text-red-200 border border-red-500/40"}`,children:E.text}),e.jsx("div",{className:`${M?"opacity-0":"opacity-100"} transition-opacity duration-300`,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Total categorías"}),e.jsx("div",{className:"text-lg text-white font-semibold",children:o.length})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Activas"}),e.jsx("div",{className:"text-lg text-white font-semibold",children:o.filter(t=>!!t.active).length})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Con imagen"}),e.jsx("div",{className:"text-lg text-white font-semibold",children:o.filter(t=>!!t.image).length})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Sin imagen"}),e.jsx("div",{className:"text-lg text-white font-semibold",children:o.filter(t=>!t.image).length})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Categorías"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:t=>{u(1),R(t.target.value)},placeholder:"Buscar...",className:"px-2 py-1 text-xs rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("select",{value:p,onChange:t=>U(t.target.value),className:"px-2 py-1 text-xs rounded bg-gray-700 text-white border border-gray-600",children:[e.jsx("option",{value:"-created_at",children:"Más recientes"}),e.jsx("option",{value:"name",children:"Nombre A-Z"}),e.jsx("option",{value:"-name",children:"Nombre Z-A"}),e.jsx("option",{value:"active",children:"Estado"})]}),e.jsx("button",{onClick:()=>x(!0),disabled:n!=="admin"&&n!=="super_admin",className:"px-2 py-1 text-xs rounded bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50",children:"Nueva"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[e.jsx("thead",{className:"bg-gray-800 text-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"Nombre"}),e.jsx("th",{className:"px-3 py-2",children:"Descripción"}),e.jsx("th",{className:"px-3 py-2",children:"Estado"}),e.jsx("th",{className:"px-3 py-2",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2",children:"Acciones"})]})}),e.jsxs("tbody",{children:[o.map(t=>e.jsxs("tr",{className:"border-t border-gray-700",children:[e.jsx("td",{className:"px-3 py-2",children:t.name}),e.jsx("td",{className:"px-3 py-2 whitespace-pre-wrap",children:t.description||""}),e.jsx("td",{className:"px-3 py-2",children:t.active?"Activo":"Inactivo"}),e.jsx("td",{className:"px-3 py-2",children:new Date(t.created_at).toLocaleString()}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O(t),disabled:n!=="admin"&&n!=="super_admin",className:"px-2 py-1 text-xs rounded bg-indigo-600 hover:bg-indigo-700 text-white disabled:opacity-50",children:"Editar"}),e.jsx("button",{onClick:()=>G(t.id),disabled:n!=="admin"&&n!=="super_admin",className:"px-2 py-1 text-xs rounded bg-red-600 hover:bg-red-700 text-white disabled:opacity-50",children:"Eliminar"})]})})]},t.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-4 text-center text-gray-400",colSpan:5,children:"No hay categorías."})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-gray-300",children:[e.jsxs("div",{children:["Página ",$," de ",_]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(t=>Math.max(1,t-1)),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Anterior"}),e.jsx("button",{onClick:()=>u(t=>Math.min(_,t+1)),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Siguiente"}),e.jsx("select",{value:g,onChange:t=>{T(Number(t.target.value)),u(1)},className:"px-2 py-1 text-xs rounded bg-gray-700 text-white border border-gray-600",children:[10,20,50].map(t=>e.jsxs("option",{value:t,children:[t,"/página"]},t))})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:"text-white font-medium",children:"Imágenes"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:o.map(t=>e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-2",children:[e.jsx("div",{className:"text-gray-200 text-sm truncate",children:t.name}),e.jsx("div",{className:"mt-2",children:t.image?e.jsx("img",{src:J(t.image),alt:t.name,className:"w-full h-24 object-cover rounded border border-gray-600"}):e.jsx("div",{className:"w-full h-24 flex items-center justify-center text-gray-500 border border-dashed border-gray-600 rounded",children:"Sin imagen"})}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("button",{onClick:()=>O(t),disabled:n!=="admin"&&n!=="super_admin",className:"px-2 py-1 text-xs rounded bg-indigo-600 hover:bg-indigo-700 text-white disabled:opacity-50",children:"Editar"})})]},t.id))})]})]})}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded p-4 w-full max-w-lg",children:[e.jsx("div",{className:"text-white font-medium mb-3",children:A?"Editar categoría":"Nueva categoría"}),e.jsxs("form",{onSubmit:A?H:q,className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",value:b,onChange:t=>y(t.target.value),required:!0,maxLength:100,className:`px-3 py-2 rounded bg-gray-700 text-white border ${w.name?"border-red-600":"border-gray-600"} focus:outline-none focus:ring-2 focus:ring-blue-500 md:col-span-2`,placeholder:"Nombre de la categoría"}),e.jsx("textarea",{value:j,onChange:t=>f(t.target.value),maxLength:500,className:`px-3 py-2 rounded bg-gray-700 text-white border ${w.description?"border-red-600":"border-gray-600"} focus:outline-none focus:ring-2 focus:ring-blue-500 md:col-span-2`,placeholder:"Descripción",rows:4}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:t=>v(t.target.checked)}),"Activa"]}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>N(t.target.files?t.target.files[0]:null),className:`px-3 py-2 rounded bg-gray-700 text-white border ${w.image?"border-red-600":"border-gray-600"} focus:outline-none focus:ring-2 focus:ring-blue-500 md:col-span-2`}),d&&e.jsx("img",{src:URL.createObjectURL(d),alt:"Preview",className:"md:col-span-2 w-32 h-32 object-cover rounded border border-gray-600"}),e.jsxs("div",{className:"col-span-1 md:col-span-2 flex items-center justify-end gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),z(null)},className:"px-3 py-2 rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white",children:"Guardar"})]}),Object.values(w).length>0&&e.jsx("div",{className:"md:col-span-2 text-red-300 text-sm",children:"Revise los errores marcados en el formulario."})]})]})})]})};export{V as default};
