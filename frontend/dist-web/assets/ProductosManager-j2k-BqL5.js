import{r,j as e}from"./index-DLBiUv4k.js";import"./vendor-BtP0CW_r.js";const J=({token:i,apiBase:d,onCreate:b,onEdit:p})=>{const[l,E]=r.useState([]),[g,o]=r.useState(null),[N,v]=r.useState(!1),[a,w]=r.useState(null),[L,P]=r.useState([]),[f,S]=r.useState([]),[C,_]=r.useState(""),[x,F]=r.useState(""),[u,I]=r.useState("all"),[k,T]=r.useState(!1),[h,D]=r.useState(5),m=s=>({...s?{Authorization:`Bearer ${s}`}:{}}),y=async()=>{o(null),v(!0);try{const s=await fetch(`${d}/products/`,{headers:m(i)}),t=await s.json();if(!s.ok)throw new Error(t.detail||"No se pudieron cargar productos");E(t)}catch(s){o({type:"error",text:s.message})}finally{v(!1)}};r.useEffect(()=>{i&&y()},[i]),r.useEffect(()=>{i&&(async()=>{try{const c=await(await fetch(`${d}/products/categories/?page_size=100`,{headers:m(i)})).json(),n=Array.isArray(c.results)?c.results:[];P(n)}catch{}})()},[i]);const A=s=>{if(s===""||s==null)return"";const t=Number(s);return Number.isNaN(t)?"":t.toLocaleString("es-CO",{style:"currency",currency:"COP"})},j=s=>{const t=Number(s.total_stock??s.inventory_qty??0);return Number.isFinite(t)?t:0},O=l.filter(s=>{const t=C.trim().toLowerCase(),c=t===""||String(s.name||"").toLowerCase().includes(t),n=!x||String(s.category)===String(x)||String(s.category_name||"")===String(x),R=u==="all"||(u==="active"?!!s.active:!s.active),U=j(s),H=!k||U<Number(h||0);return c&&n&&R&&H}),z=l.length,W=l.filter(s=>j(s)<Number(h||0)).length,q=l.filter(s=>!!s.active).length,V=l.filter(s=>!s.active).length,M=async s=>{o(null);try{const t=await fetch(`${d}/products/${s}/`,{method:"DELETE",headers:m(i)});if(!t.ok){const c=await t.json();throw new Error(c.detail||"No se pudo eliminar")}o({type:"success",text:"Producto eliminado"}),y()}catch(t){o({type:"error",text:t.message})}},$=s=>s?s.startsWith("http://")||s.startsWith("https://")?s:s.startsWith("/")?`${d}${s}`:s.startsWith("media/")?`${d}/${s}`:`${d}/media/${s}`:"";return e.jsxs("div",{className:"space-y-4 relative",children:[N&&e.jsx("div",{className:"absolute inset-0 z-50 bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"bg-gray-800/80 border border-white/10 rounded-xl p-6 shadow-xl text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"mt-3 text-white font-medium",children:"Cargando datos..."}),e.jsx("div",{className:"text-xs text-gray-300",children:"Por favor espera"})]})}),g&&e.jsx("div",{className:`p-3 rounded text-sm ${g.type==="success"?"bg-green-600/20 text-green-200 border border-green-500/40":"bg-red-600/20 text-red-200 border border-red-500/40"}`,children:g.text}),e.jsx("div",{className:`${N?"opacity-0":"opacity-100"} transition-opacity duration-300`,children:e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Productos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{b&&b()},className:"px-2 py-1 text-xs rounded bg-blue-600 hover:bg-blue-700 text-white",children:"Nuevo producto"}),e.jsx("button",{onClick:y,className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Recargar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Total productos"}),e.jsx("div",{className:"text-lg text-white font-semibold",children:z})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:["Bajo stock (<",h,")"]}),e.jsx("div",{className:"text-lg text-white font-semibold",children:W})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Activos"}),e.jsx("div",{className:"text-lg text-white font-semibold",children:q})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Inactivos"}),e.jsx("div",{className:"text-lg text-white font-semibold",children:V})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 mb-3",children:[e.jsx("input",{type:"text",value:C,onChange:s=>_(s.target.value),placeholder:"Buscar por nombre",className:"px-2 py-1 rounded bg-gray-700 text-white border border-gray-600 text-xs md:col-span-2"}),e.jsxs("select",{value:x,onChange:s=>F(s.target.value),className:"px-2 py-1 rounded bg-gray-700 text-white border border-gray-600 text-xs",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:u,onChange:s=>I(s.target.value),className:"px-2 py-1 rounded bg-gray-700 text-white border border-gray-600 text-xs",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"active",children:"Activos"}),e.jsx("option",{value:"inactive",children:"Inactivos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-1 text-gray-300 text-xs",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:s=>T(s.target.checked)})," Bajo stock"]}),e.jsx("input",{type:"number",min:0,value:h,onChange:s=>D(Number(s.target.value)||0),className:"w-16 px-2 py-1 rounded bg-gray-700 text-white border border-gray-600 text-xs"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[e.jsx("thead",{className:"bg-gray-800 text-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"Imagen"}),e.jsx("th",{className:"px-3 py-2",children:"Nombre"}),e.jsx("th",{className:"px-3 py-2",children:"Precio"}),e.jsx("th",{className:"px-3 py-2",children:"Categoría"}),e.jsx("th",{className:"px-3 py-2",children:"Estado"}),e.jsx("th",{className:"px-3 py-2",children:"Stock total"}),e.jsx("th",{className:"px-3 py-2",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2",children:"Acciones"})]})}),e.jsxs("tbody",{children:[O.map(s=>e.jsxs("tr",{className:"border-t border-gray-700",children:[e.jsx("td",{className:"px-3 py-2",children:s.image?e.jsx("img",{src:$(s.image),alt:"Producto",className:"w-16 h-16 object-cover rounded border border-gray-600"}):e.jsx("span",{className:"text-gray-500",children:"Sin imagen"})}),e.jsx("td",{className:"px-3 py-2",children:s.name}),e.jsx("td",{className:"px-3 py-2",children:A(s.price)}),e.jsx("td",{className:"px-3 py-2",children:s.category_name||""}),e.jsx("td",{className:"px-3 py-2",children:s.active?"Activo":"Inactivo"}),e.jsx("td",{className:"px-3 py-2",children:j(s)}),e.jsx("td",{className:"px-3 py-2",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{w(s);try{const c=await(await fetch(`${d}/products/${s.id}/colors/`,{headers:m(i)})).json(),n=Array.isArray(c.results)?c.results:c;S(Array.isArray(n)?n:[])}catch{S([])}},className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Ver"}),e.jsx("button",{onClick:()=>{p&&p(s)},className:"px-2 py-1 text-xs rounded bg-indigo-600 hover:bg-indigo-700 text-white",children:"Editar"}),e.jsx("button",{onClick:()=>M(s.id),className:"px-2 py-1 text-xs rounded bg-red-600 hover:bg-red-700 text-white",children:"Eliminar"})]})})]},s.id)),l.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-4 text-center text-gray-400",colSpan:8,children:"No hay productos registrados."})})]})]})})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded p-4 w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Detalle del producto"}),e.jsx("button",{onClick:()=>w(null),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cerrar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-1",children:a.image?e.jsx("img",{src:$(a.image),alt:a.name,className:"w-full h-40 object-cover rounded border border-gray-600"}):e.jsx("div",{className:"w-full h-40 flex items-center justify-center text-gray-500 border border-dashed border-gray-600 rounded",children:"Sin imagen"})}),e.jsxs("div",{className:"md:col-span-2 space-y-2 text-gray-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Nombre:"})," ",a.name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Precio:"})," ",A(a.price)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Categoría:"})," ",a.category_name||""]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"SKU:"})," ",a.sku||""]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Cantidad:"})," ",a.inventory_qty]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Estado:"})," ",a.active?"Activo":"Inactivo"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Fecha:"})," ",new Date(a.created_at).toLocaleString()]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-400",children:"Descripción:"}),e.jsx("p",{className:"mt-1 whitespace-pre-wrap",children:a.description})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-400",children:"Colores:"}),e.jsxs("div",{className:"mt-1 grid grid-cols-2 md:grid-cols-3 gap-2",children:[f.map(s=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700/40 border border-gray-600 rounded p-2",children:[e.jsx("div",{className:"w-5 h-5 rounded",style:{backgroundColor:s.hex}}),e.jsxs("div",{className:"text-xs text-gray-200",children:[s.name," · Stock: ",s.stock]})]},s.id)),f.length===0&&e.jsx("div",{className:"text-xs text-gray-400",children:"Sin colores definidos."})]})]})]})]})]})})]})};export{J as default};
