import{r as i,j as e,i as u,S as H,P as T,C,e as S,U as v,a as J,b as X,X as D,M as Z}from"./index-B0-dYYhW.js";import{D as _}from"./dollar-sign-_EJxGbDI.js";import{F as K}from"./file-text-B0_F9R2G.js";import{C as Q}from"./credit-card-CnXXOS-s.js";import{M as W}from"./map-pin-Dp4W-hb_.js";import"./vendor-BtP0CW_r.js";const le=({token:r,apiBase:c})=>{const[h,P]=i.useState([]),[A,I]=i.useState([]),[Y,k]=i.useState(!1),[L,g]=i.useState(!1),[d,M]=i.useState(""),[p,O]=i.useState({total:0,delivered:0,received:0,total_value:0}),[$]=i.useState(20),[j,F]=i.useState("-created_at"),[l,N]=i.useState({name:"",description:"",third_party_provider:"",value:"",clientId:"",status:"recibido"}),[q,b]=i.useState(!1),[n,z]=i.useState({full_name:"",cedula:"",email:"",address:""}),m=a=>({"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}}),E=async()=>{if(r)try{const a=await fetch(`${c}/clients/?page_size=100`,{headers:m(r)}),s=await a.json();a.ok&&Array.isArray(s.results)&&I(s.results)}catch(a){console.error("Error loading clients:",a)}};i.useEffect(()=>{E()},[r,c]);const y=async()=>{if(r){k(!0);try{const a=new URL(`${c}/services/`);d&&a.searchParams.set("search",d),a.searchParams.set("page_size",String($)),a.searchParams.set("ordering",j);const s=await fetch(a.toString(),{headers:m(r)}),t=await s.json();if(s.ok){const o=Array.isArray(t.results)?t.results:Array.isArray(t)?t:[];P(o)}}catch(a){console.error("Error loading services:",a)}finally{k(!1)}}},w=async()=>{if(r)try{const a=await fetch(`${c}/services/stats/`,{headers:m(r)}),s=await a.json();a.ok&&O({total:Number(s.total||0),delivered:Number(s.delivered||0),received:Number(s.received||0),total_value:Number(s.total_value||0)})}catch{}};i.useEffect(()=>{y(),w()},[r]),i.useEffect(()=>{const a=setTimeout(()=>y(),300);return()=>clearTimeout(a)},[d,j]);const x=a=>{const{name:s,value:t}=a.target;N(o=>({...o,[s]:t}))},f=a=>{const{name:s,value:t}=a.target;z(o=>({...o,[s]:t}))},R=async a=>{if(a.preventDefault(),!!r){if(!n.full_name||!n.cedula){alert("Nombre y Cédula son obligatorios");return}try{const s=new FormData;s.append("full_name",n.full_name),s.append("cedula",n.cedula),s.append("email",n.email),s.append("address",n.address);const t=await fetch(`${c}/clients/`,{method:"POST",headers:{...r?{Authorization:`Bearer ${r}`}:{}},body:s}),o=await t.json();if(!t.ok)throw new Error(o.detail||"No se pudo registrar el cliente");await E(),N(V=>({...V,clientId:String(o.id)})),b(!1),z({full_name:"",cedula:"",email:"",address:""})}catch(s){alert(s.message||"Error al crear cliente")}}},G=async a=>{if(a.preventDefault(),!l.name||!l.description||!l.value||!l.clientId){alert("Por favor complete los campos obligatorios");return}if(r)try{const s={name:l.name,description:l.description,third_party_provider:l.third_party_provider||"",value:Number(l.value),client:Number(l.clientId),status:l.status},t=await fetch(`${c}/services/`,{method:"POST",headers:m(r),body:JSON.stringify(s)}),o=await t.json();if(!t.ok)throw new Error(o.detail||"No se pudo crear el servicio");g(!1),N({name:"",description:"",third_party_provider:"",value:"",clientId:"",status:"recibido"}),y(),w()}catch(s){alert(s.message||"Error al crear el servicio")}},U=async(a,s)=>{if(r)try{const t=await fetch(`${c}/services/${a}/`,{method:"PATCH",headers:m(r),body:JSON.stringify({status:s==="recibido"?"entregado":"recibido"})});if(!t.ok){const o=await t.json();throw new Error(o.detail||"No se pudo actualizar el estado")}y(),w()}catch(t){alert(t.message||"Error al actualizar estado")}};return h.filter(a=>a.name.toLowerCase().includes(d.toLowerCase())||a.clientName.toLowerCase().includes(d.toLowerCase())),e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500 h-full flex flex-col",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-gray-900 p-6 rounded-2xl border border-gray-800",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx("span",{className:"p-2 rounded-lg bg-indigo-500/10 text-indigo-400",children:e.jsx(u,{className:"w-5 h-5"})}),"Gestión de Servicios"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Administra los servicios ofrecidos a tus clientes"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Buscar servicio...",value:d,onChange:a=>M(a.target.value),className:"w-full sm:w-64 bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none placeholder:text-gray-600"})]}),e.jsxs("select",{value:j,onChange:a=>F(a.target.value),className:"bg-gray-800 border-none text-xs text-gray-400 rounded-lg focus:ring-0 px-3 py-2",children:[e.jsx("option",{value:"-created_at",children:"Más recientes"}),e.jsx("option",{value:"created_at",children:"Más antiguos"}),e.jsx("option",{value:"name",children:"Nombre A-Z"}),e.jsx("option",{value:"-value",children:"Mayor valor"}),e.jsx("option",{value:"value",children:"Menor valor"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-brand px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Servicio"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gray-900 border border-gray-800 p-6 transition-all hover:border-gray-700 hover:shadow-lg hover:shadow-black/50 group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 text-blue-400",children:e.jsx(u,{className:"w-16 h-16"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-800 text-blue-400 bg-opacity-10",children:e.jsx(u,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Total Servicios"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:p.total})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gray-900 border border-gray-800 p-6 transition-all hover:border-gray-700 hover:shadow-lg hover:shadow-black/50 group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 text-emerald-400",children:e.jsx(C,{className:"w-16 h-16"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-800 text-emerald-400 bg-opacity-10",children:e.jsx(C,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Entregados"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:p.delivered})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gray-900 border border-gray-800 p-6 transition-all hover:border-gray-700 hover:shadow-lg hover:shadow-black/50 group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 text-amber-400",children:e.jsx(S,{className:"w-16 h-16"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-800 text-amber-400 bg-opacity-10",children:e.jsx(S,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Recibidos"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:p.received})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gray-900 border border-gray-800 p-6 transition-all hover:border-gray-700 hover:shadow-lg hover:shadow-black/50 group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 text-purple-400",children:e.jsx(_,{className:"w-16 h-16"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-800 text-purple-400 bg-opacity-10",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Valor Total"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:p.total_value.toLocaleString("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0})})]})]})]})]}),e.jsx("div",{className:"flex-1 bg-gray-900 border border-gray-800 rounded-2xl overflow-hidden flex flex-col shadow-xl",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-800/50 text-xs uppercase text-gray-400",children:e.jsxs("tr",{className:"border-b border-gray-800",children:[e.jsx("th",{className:"px-6 py-3 font-medium tracking-wider",children:"Servicio"}),e.jsx("th",{className:"px-6 py-3 font-medium tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 font-medium tracking-wider",children:"Tercero"}),e.jsx("th",{className:"px-6 py-3 font-medium tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 font-medium tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 font-medium tracking-wider text-right",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:(h.length>0?h:[]).length>0?(h||[]).filter(a=>a.name.toLowerCase().includes(d.toLowerCase())||(a.client_name||"").toLowerCase().includes(d.toLowerCase())).map(a=>e.jsxs("tr",{className:"group hover:bg-white/5 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-white",children:a.name}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:a.description})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(v,{className:"w-3 h-3 text-gray-500"}),a.client_name]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-400 text-sm",children:a.third_party_provider||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"font-medium text-white",children:["$",Number(a.value||0).toLocaleString()]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>U(a.id,a.status),className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border transition-all ${a.status==="entregado"?"bg-emerald-500/10 text-emerald-400 border-emerald-500/20 hover:bg-emerald-500/20":"bg-amber-500/10 text-amber-400 border-amber-500/20 hover:bg-amber-500/20"}`,children:a.status==="entregado"?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-3 h-3"})," Entregado"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-3 h-3"})," Recibido"]})})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1.5 text-rose-400 hover:text-rose-300 hover:bg-rose-500/10 rounded-lg transition-colors",children:e.jsx(X,{className:"w-4 h-4"})})]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500",children:[e.jsx("div",{className:"bg-gray-800 p-4 rounded-full mb-3",children:e.jsx(u,{className:"w-8 h-8 opacity-50"})}),e.jsx("p",{className:"text-lg font-medium text-gray-400",children:"No hay servicios registrados"}),e.jsx("p",{className:"text-sm mt-1",children:"Comienza agregando un nuevo servicio para tus clientes."})]})})})})]})})}),L&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-lg shadow-2xl animate-in zoom-in-95 duration-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center bg-gray-800/50",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Nuevo Servicio"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:G,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Nombre del Servicio"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",name:"name",value:l.name,onChange:x,placeholder:"Ej. Reparación de PC",className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none transition-all",required:!0})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Descripción"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-3 w-4 h-4 text-gray-500"}),e.jsx("textarea",{name:"description",value:l.description,onChange:x,placeholder:"Detalles del servicio...",rows:3,className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none transition-all resize-none",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Cliente"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsxs("select",{name:"clientId",value:l.clientId,onChange:x,className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none appearance-none transition-all",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar Cliente"}),A.map(a=>e.jsx("option",{value:a.id,children:a.full_name},a.id))]})]}),e.jsx("button",{type:"button",onClick:()=>b(!0),className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-400 hover:text-white hover:border-gray-600 transition-colors",title:"Crear nuevo cliente",children:e.jsx(T,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Valor"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"number",name:"value",value:l.value,onChange:x,placeholder:"0.00",min:"0",className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none transition-all",required:!0})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Realizado por Tercero (Opcional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",name:"third_party_provider",value:l.third_party_provider,onChange:x,placeholder:"Nombre del técnico o empresa externa",className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none transition-all"})]})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"flex-1 px-4 py-2.5 border border-gray-700 rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-800 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 btn-brand rounded-lg text-sm font-medium text-white transition-all",children:"Guardar Servicio"})]})]})]})}),q&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-lg shadow-2xl animate-in zoom-in-95 duration-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center bg-gray-800/50",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Registrar Nuevo Cliente"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:R,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Nombre Completo"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",name:"full_name",value:n.full_name,onChange:f,placeholder:"Nombre del cliente",className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none transition-all",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Cédula / NIT"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",name:"cedula",value:n.cedula,onChange:f,placeholder:"Número de identificación",className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none transition-all",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Correo Electrónico"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"email",name:"email",value:n.email,onChange:f,placeholder:"cliente@ejemplo.com",className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1.5 uppercase tracking-wide",children:"Dirección"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",name:"address",value:n.address,onChange:f,placeholder:"Dirección de residencia",className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white focus:ring-2 focus:ring-indigo-500/40 focus:outline-none transition-all"})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"flex-1 px-4 py-2.5 border border-gray-700 rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-800 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-medium text-white shadow-lg shadow-indigo-900/20 transition-all",children:"Guardar Cliente"})]})]})]})})]})};export{le as default};
