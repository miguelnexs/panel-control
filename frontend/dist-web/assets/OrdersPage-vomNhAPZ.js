import{r as a,j as e}from"./index-DLBiUv4k.js";import"./vendor-BtP0CW_r.js";const E=({token:m,apiBase:b})=>{var P;const[L,_]=a.useState([]),[$,O]=a.useState([]),[d,M]=a.useState([]),[j,N]=a.useState(1),[h,D]=a.useState(10),[g,A]=a.useState(0),[v,z]=a.useState(null),[i,w]=a.useState(null),f=t=>({...t?{Authorization:`Bearer ${t}`}:{}}),[S,C]=a.useState(!1);a.useEffect(()=>{m&&(async()=>{C(!0);try{const c=new URLSearchParams({page:String(j),page_size:String(h)}),[l,n,o]=await Promise.all([fetch(`${b}/products/`,{headers:f(m)}),fetch(`${b}/clients/?page_size=200`,{headers:f(m)}),fetch(`${b}/sales/list/?${c.toString()}`,{headers:f(m)})]),r=await l.json(),s=(Array.isArray(r)?r:[]).filter(p=>!!p.active);_(s);const u=await n.json();O(Array.isArray(u.results)?u.results:[]);const x=await o.json();M(Array.isArray(x.results)?x.results:[]),A(Number(x.count||0))}catch{}finally{C(!1)}})()},[m,j,h]);const y=a.useMemo(()=>{const t=g,c=d.reduce((r,s)=>r+Number(s.total_amount||0),0),l=new Date,n=d.filter(r=>{const s=new Date(r.created_at);return s.getFullYear()===l.getFullYear()&&s.getMonth()===l.getMonth()&&s.getDate()===l.getDate()}).length,o=d.filter(r=>{const s=new Date(r.created_at);return s.getFullYear()===l.getFullYear()&&s.getMonth()===l.getMonth()}).length;return{totalOrders:t,amountSum:c,todayCount:n,monthCount:o}},[d,g]);return e.jsxs("div",{className:"space-y-4 relative",children:[S&&e.jsx("div",{className:"absolute inset-0 z-50 bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"bg-gray-800/80 border border-white/10 rounded-xl p-6 shadow-xl text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"mt-3 text-white font-medium",children:"Cargando datos..."}),e.jsx("div",{className:"text-xs text-gray-300",children:"Por favor espera"})]})}),v&&e.jsx("div",{className:`p-3 rounded text-sm ${v.type==="success"?"bg-green-600/20 text-green-200 border border-green-500/40":"bg-red-600/20 text-red-200 border border-red-500/40"}`,children:v.text}),e.jsxs("div",{className:`${S?"opacity-0":"opacity-100"} transition-opacity duration-300`,children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Total pedidos"}),e.jsx("div",{className:"text-base text-white font-semibold",children:y.totalOrders})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Monto (página)"}),e.jsx("div",{className:"text-base text-white font-semibold",children:y.amountSum.toLocaleString("es-CO",{style:"currency",currency:"COP"})})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Pedidos hoy"}),e.jsx("div",{className:"text-base text-white font-semibold",children:y.todayCount})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Este mes (página)"}),e.jsx("div",{className:"text-base text-white font-semibold",children:y.monthCount})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Pedidos"}),e.jsxs("div",{className:"text-gray-300 text-sm",children:["Fecha y hora: ",new Date().toLocaleString()]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[e.jsx("thead",{className:"bg-gray-800 text-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"N° Pedido"}),e.jsx("th",{className:"px-3 py-2",children:"Cliente"}),e.jsx("th",{className:"px-3 py-2",children:"Total"}),e.jsx("th",{className:"px-3 py-2",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2",children:"Items"}),e.jsx("th",{className:"px-3 py-2",children:"Acciones"})]})}),e.jsxs("tbody",{children:[d.map(t=>{var c;return e.jsxs("tr",{className:"border-t border-gray-700",children:[e.jsx("td",{className:"px-3 py-2",children:t.order_number}),e.jsx("td",{className:"px-3 py-2",children:(c=t.client)==null?void 0:c.full_name}),e.jsx("td",{className:"px-3 py-2",children:Number(t.total_amount).toLocaleString("es-CO",{style:"currency",currency:"COP"})}),e.jsx("td",{className:"px-3 py-2",children:new Date(t.created_at).toLocaleString()}),e.jsx("td",{className:"px-3 py-2",children:t.items_count}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("button",{onClick:()=>w(t),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Ver"})})]},t.id)}),d.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-4 text-center text-gray-400",colSpan:6,children:"Sin pedidos registrados."})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-gray-300",children:[e.jsxs("div",{children:["Página ",j," de ",Math.max(1,Math.ceil(g/h))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(t=>Math.max(1,t-1)),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Anterior"}),e.jsx("button",{onClick:()=>N(t=>Math.min(Math.max(1,Math.ceil(g/h)),t+1)),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Siguiente"}),e.jsx("select",{value:h,onChange:t=>{D(Number(t.target.value)),N(1)},className:"px-2 py-1 text-xs rounded bg-gray-700 text-white border border-gray-600",children:[10,20,50].map(t=>e.jsxs("option",{value:t,children:[t,"/página"]},t))})]})]})]})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded-xl p-4 w-full max-w-3xl max-h-[85vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Detalle del pedido"}),e.jsx("button",{onClick:()=>w(null),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cerrar"})]}),e.jsxs("div",{className:"text-gray-300 text-sm mb-2",children:["Pedido: ",e.jsx("span",{className:"text-white font-medium",children:i.order_number})]}),e.jsxs("div",{className:"text-gray-300 text-sm mb-2",children:["Cliente: ",e.jsx("span",{className:"text-white font-medium",children:(P=i.client)==null?void 0:P.full_name})]}),e.jsxs("div",{className:"text-gray-300 text-sm mb-4",children:["Total: ",e.jsx("span",{className:"text-white font-medium",children:Number(i.total_amount).toLocaleString("es-CO",{style:"currency",currency:"COP"})})]}),e.jsx("div",{className:"overflow-y-auto flex-1",children:e.jsxs("div",{className:"space-y-2",children:[(i.items||[]).map((t,c)=>{var l,n,o,r,s,u,x,p;return e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-start bg-gray-700/40 border border-gray-600 rounded p-2",children:[e.jsx("div",{className:"col-span-2",children:(l=t.product)!=null&&l.image?e.jsx("img",{src:t.product.image,alt:(n=t.product)==null?void 0:n.name,className:"w-20 h-20 object-cover rounded border border-gray-600"}):e.jsx("div",{className:"w-20 h-20 flex items-center justify-center text-gray-500 border border-dashed border-gray-600 rounded",children:"Sin imagen"})}),e.jsxs("div",{className:"col-span-10 space-y-1",children:[e.jsx("div",{className:"text-white font-medium",children:(o=t.product)==null?void 0:o.name}),e.jsxs("div",{className:"text-gray-300 text-sm",children:["SKU: ",((r=t.product)==null?void 0:r.sku)||"—"," · Categoría: ",((s=t.product)==null?void 0:s.category_name)||"—"]}),e.jsxs("div",{className:"text-gray-300 text-sm",children:["Descripción: ",e.jsx("span",{className:"text-gray-200",children:((u=t.product)==null?void 0:u.description)||"—"})]}),e.jsxs("div",{className:"text-gray-300 text-sm flex items-center gap-2",children:["Color: ",((x=t.color)==null?void 0:x.name)||"Sin color"," ",((p=t.color)==null?void 0:p.hex)&&e.jsx("span",{className:"inline-block w-4 h-4 rounded border border-gray-600",style:{backgroundColor:t.color.hex}})]}),e.jsxs("div",{className:"text-gray-300 text-sm",children:["Cantidad: ",t.quantity," · Precio unitario: ",Number(t.unit_price).toLocaleString("es-CO",{style:"currency",currency:"COP"})," · Subtotal: ",Number(t.line_total).toLocaleString("es-CO",{style:"currency",currency:"COP"})]})]})]},`it-${c}`)}),(i.items||[]).length===0&&e.jsx("div",{className:"text-gray-400 text-sm",children:"Sin items."})]})})]})})]})};export{E as default};
