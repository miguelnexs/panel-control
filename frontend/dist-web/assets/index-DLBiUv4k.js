const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ProductosManager-j2k-BqL5.js","./vendor-BtP0CW_r.js","./ProductFormPage-CFrpSRoW.js","./CategoriesManager-DIjAkLn2.js","./SalesPage-21lp5ASf.js","./OrdersPage-vomNhAPZ.js","./ClientsPage-CBdqgCqA.js","./WebPageManager-BV3STy12.js","./PlansManager-BxS7oxl0.js","./ConfigPage-CINIdEZB.js","./CashboxPage-CZTWHVtj.js"])))=>i.map(i=>d[i]);
import{r as me,g as he,a as ge}from"./vendor-BtP0CW_r.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const m of n.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function x(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function p(o){if(o.ep)return;o.ep=!0;const n=x(o);fetch(o.href,n)}})();var ie={exports:{}},re={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ce;function fe(){if(ce)return re;ce=1;var t=me(),r=Symbol.for("react.element"),x=Symbol.for("react.fragment"),p=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function m(f,i,d){var c,y={},v=null,S=null;d!==void 0&&(v=""+d),i.key!==void 0&&(v=""+i.key),i.ref!==void 0&&(S=i.ref);for(c in i)p.call(i,c)&&!n.hasOwnProperty(c)&&(y[c]=i[c]);if(f&&f.defaultProps)for(c in i=f.defaultProps,i)y[c]===void 0&&(y[c]=i[c]);return{$$typeof:r,type:f,key:v,ref:S,props:y,_owner:o.current}}return re.Fragment=x,re.jsx=m,re.jsxs=m,re}var de;function be(){return de||(de=1,ie.exports=fe()),ie.exports}var e=be(),l=me();const D=he(l);var le={},ue;function ye(){if(ue)return le;ue=1;var t=ge();return le.createRoot=t.createRoot,le.hydrateRoot=t.hydrateRoot,le}var je=ye();const we=he(je),ve="modulepreload",Ne=function(t,r){return new URL(t,r).href},xe={},q=function(r,x,p){let o=Promise.resolve();if(x&&x.length>0){let m=function(c){return Promise.all(c.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};const f=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),d=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=m(x.map(c=>{if(c=Ne(c,p),c in xe)return;xe[c]=!0;const y=c.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(!!p)for(let w=f.length-1;w>=0;w--){const A=f[w];if(A.href===c&&(!y||A.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${v}`))return;const $=document.createElement("link");if($.rel=y?"stylesheet":ve,y||($.as="script"),$.crossOrigin="",$.href=c,d&&$.setAttribute("nonce",d),document.head.appendChild($),y)return new Promise((w,A)=>{$.addEventListener("load",w),$.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(m){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=m,window.dispatchEvent(f),!f.defaultPrevented)throw m}return o.then(m=>{for(const f of m||[])f.status==="rejected"&&n(f.reason);return r().catch(n)})},pe="http://127.0.0.1:8000",Ce=(t,r=!0)=>{const x={};return r&&(x["Content-Type"]="application/json"),t&&(x.Authorization=`Bearer ${t}`),x},C=({name:t,className:r="w-5 h-5"})=>t==="dashboard"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M12 3v18M3 12h18",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):t==="users"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"8",r:"3.5",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("circle",{cx:"6.5",cy:"10",r:"2.5",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M2.5 20c0-3.5 4.5-6 9.5-6s9.5 2.5 9.5 6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M3.5 18.5c0-2 2.8-3.8 6-4.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):t==="inventory"?e.jsx("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}):t==="products"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M3 8l9-5 9 5v8l-9 5-9-5V8z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),e.jsx("path",{d:"M3 8l9 5 9-5M12 3v5M12 13v8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}):t==="categories"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 4l8 4-8 4-8-4 8-4z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 12l8 4 8-4M4 16l8 4 8-4",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"})]}):t==="clients"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("circle",{cx:"8",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M14 10h5M14 14h5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):t==="sales"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"9",cy:"19",r:"1.5",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("circle",{cx:"17",cy:"19",r:"1.5",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M5 5h2l2 9h8l2-7H7",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}):t==="orders"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M7 3h10a2 2 0 012 2v14l-3-2-3 2-3-2-3 2V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 8h8M9 12h8M9 16h8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):t==="web"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M3 12h18M12 3c3.5 3.5 3.5 17.5 0 19M7 5c2 2 2 12 0 14M17 5c-2 2-2 12 0 14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):t==="settings"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 8.5a3.5 3.5 0 100 7 3.5 3.5 0 000-7z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M4 12c0-.7.1-1.3.3-1.9l-1.7-1.3 2-3.4 2 .6c.6-.5 1.3-.9 2-.9l.5-2.1h4l.5 2.1c.7 0 1.4.4 2 .9l2-.6 2 3.4-1.7 1.3c.2.6.3 1.2.3 1.9s-.1 1.3-.3 1.9l1.7 1.3-2 3.4-2-.6c-.6.5-1.3.9-2 .9l-.5 2.1h-4l-.5-2.1c-.7 0-1.4-.4-2-.9l-2 .6-2-3.4 1.7-1.3c-.2-.6-.3-1.2-.3-1.9z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}):t==="plans"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"1.5"})]}):t==="logout"?e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M13 16l4-4-4-4M17 12H9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7 21H5a2 2 0 01-2-2V5a2 2 0 012-2h2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):null,E=({label:t,value:r,delta:x,positive:p,icon:o,tone:n="blue"})=>{const m=n==="emerald"?"bg-emerald-600/20 text-emerald-300":n==="indigo"?"bg-indigo-600/20 text-indigo-300":n==="violet"?"bg-violet-600/20 text-violet-300":n==="rose"?"bg-rose-600/20 text-rose-300":n==="cyan"?"bg-cyan-600/20 text-cyan-300":"bg-blue-600/20 text-blue-300";return e.jsxs("div",{className:"group relative rounded-xl bg-white/5 backdrop-blur-sm border border-white/10 overflow-hidden transition shadow-sm hover:shadow-md",children:[e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-br from-white/10 to-transparent transition"}),e.jsxs("div",{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${m}`,children:e.jsx(C,{name:o,className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-400",children:t}),e.jsx("div",{className:"text-2xl font-semibold text-white",children:r}),typeof x<"u"&&e.jsxs("div",{className:`text-xs mt-1 ${p?"text-emerald-300":"text-rose-300"}`,children:[p?"▲":"▼"," ",x,"%"]})]})]})]})},ke=({data:t})=>{const r=l.useMemo(()=>{const o=Math.max(...t),n=Math.min(...t),m=o-n||1,f=t.length>1?300/(t.length-1):0;return t.map((i,d)=>{const c=d*f,y=100-(i-n)/m*100;return`${c},${y}`}).join(" ")},[t]);return e.jsx("svg",{viewBox:"0 0 300 100",className:"w-full h-24",children:e.jsx("polyline",{points:r,fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-blue-400"})})},_e=({data:t})=>{const r=Math.max(...t);return e.jsx("div",{className:"flex items-end gap-2 h-24",children:t.map((x,p)=>e.jsx("div",{className:"w-6 bg-indigo-500/70",style:{height:`${x/(r||1)*100}%`}},p))})},Se=({seriesA:t,seriesB:r})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-xl bg-white/5 backdrop-blur-sm border border-white/10 p-4",children:[e.jsx("div",{className:"text-sm text-gray-200 font-medium mb-2",children:"Tendencia de actividad"}),e.jsx(ke,{data:t})]}),e.jsxs("div",{className:"rounded-xl bg-white/5 backdrop-blur-sm border border-white/10 p-4",children:[e.jsx("div",{className:"text-sm text-gray-200 font-medium mb-2",children:"Distribución por departamentos"}),e.jsx(_e,{data:r})]})]}),$e=({stats:t,seriesA:r,seriesB:x,recentOrders:p,topProducts:o})=>{var n,m,f,i;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(E,{label:"Usuarios",value:t.usersCount,icon:"users",tone:"cyan"}),e.jsx(E,{label:"Productos",value:t.productsCount,icon:"products",tone:"indigo"}),e.jsx(E,{label:"Activos",value:t.productsActive,icon:"products",tone:"emerald"}),e.jsx(E,{label:"Categorías",value:t.categoriesCount,icon:"categories",tone:"violet"}),e.jsx(E,{label:"Clientes",value:t.clientsTotal,icon:"clients",tone:"blue"}),e.jsx(E,{label:"Pedidos",value:t.ordersTotal,icon:"orders",tone:"rose"})]}),e.jsx(Se,{seriesA:r,seriesB:x}),e.jsxs("div",{className:"rounded-xl bg-white/5 backdrop-blur-sm border border-white/10 p-4",children:[e.jsx("div",{className:"text-sm text-gray-200 font-medium",children:"Resumen"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-2",children:[e.jsx(E,{label:"Nuevos clientes (mes)",value:t.clientsNewMonth,icon:"clients",tone:"blue"}),e.jsx(E,{label:"Ventas hoy",value:t.salesToday,icon:"sales",tone:"emerald"}),e.jsx(E,{label:"Ventas totales",value:t.salesTotal,icon:"sales",tone:"indigo"}),e.jsx(E,{label:"Monto ventas",value:Number(t.salesAmount||0).toLocaleString("es-CO",{style:"currency",currency:"COP"}),icon:"sales",tone:"violet"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-xl bg-white/5 backdrop-blur-sm border border-white/10 p-4",children:[e.jsx("div",{className:"text-sm text-gray-200 font-medium mb-2",children:"Estado de pedidos"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsx(E,{label:"Pendientes",value:((n=t.statusCounts)==null?void 0:n.pending)||0,icon:"orders",tone:"rose"}),e.jsx(E,{label:"Enviados",value:((m=t.statusCounts)==null?void 0:m.shipped)||0,icon:"orders",tone:"indigo"}),e.jsx(E,{label:"Entregados",value:((f=t.statusCounts)==null?void 0:f.delivered)||0,icon:"orders",tone:"emerald"}),e.jsx(E,{label:"Cancelados",value:((i=t.statusCounts)==null?void 0:i.canceled)||0,icon:"orders",tone:"violet"})]})]}),e.jsxs("div",{className:"rounded-xl bg-white/5 backdrop-blur-sm border border-white/10 p-4",children:[e.jsx("div",{className:"text-sm text-gray-200 font-medium mb-2",children:"Productos más vendidos"}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-white/10",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/10",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-800 to-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-200",children:"Producto"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-200",children:"Cantidad"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-200",children:"Venta total"})]})}),e.jsxs("tbody",{className:"bg-gray-800/40 divide-y divide-white/10",children:[(o||[]).map((d,c)=>e.jsxs("tr",{className:"hover:bg-gray-700/50 transition",children:[e.jsx("td",{className:"px-3 py-2 text-sm text-white",children:d.name}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-300",children:d.qty}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-300",children:Number(d.amount||0).toLocaleString("es-CO",{style:"currency",currency:"COP"})})]},`${d.name}-${c}`)),(!o||o.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-3 py-2 text-sm text-gray-300",children:"Sin ventas registradas."})})]})]})})]})]})]})},Ee=({view:t,setView:r,onSignOut:x,role:p,orderNotif:o,token:n,apiBase:m,setUpdateMsg:f,subscription:i})=>{var ae,ne,oe;const[d,c]=l.useState(!1),[y,v]=l.useState(""),[S,$]=l.useState(""),[w,A]=l.useState(null),[X,F]=l.useState(null),[W,b]=l.useState(null),[k,N]=l.useState(null),[u,h]=l.useState(null),[j,z]=l.useState(!1),[P,I]=l.useState(!1),[O,Y]=l.useState(!1),K=a=>{if(a.stopPropagation(),d)if(W)b(null);else{const M=a.currentTarget.getBoundingClientRect();b({top:M.top,left:M.right}),N(null),h(null)}else z(!j),j||(I(!1),Y(!1))},Z=a=>{if(a.stopPropagation(),d)if(k)N(null);else{const M=a.currentTarget.getBoundingClientRect();N({top:M.top,left:M.right}),b(null),h(null)}else I(!P),P||(z(!1),Y(!1))},ee=a=>{if(a.stopPropagation(),d)if(u)h(null);else{const M=a.currentTarget.getBoundingClientRect();h({top:M.top,left:M.right}),b(null),N(null)}else Y(!O),O||(z(!1),I(!1))},J=a=>{try{return a?a.startsWith("http://")||a.startsWith("https://")?a:a.startsWith("/")?`${m}${a}`:`${m}/${a}`:""}catch{return a}};l.useEffect(()=>{try{const a=localStorage.getItem("sidebar_collapsed");(a==="1"||a==="0")&&c(a==="1")}catch{}},[]),l.useEffect(()=>{try{localStorage.setItem("sidebar_collapsed",d?"1":"0")}catch{}},[d]),l.useEffect(()=>{(async()=>{try{const M=n?{"Content-Type":"application/json",Authorization:`Bearer ${n}`}:{"Content-Type":"application/json"},te=n?`${m}/webconfig/settings/`:`${m}/webconfig/public/settings/`,Q=await fetch(te,{headers:M}),V=await Q.json();Q.ok&&V&&typeof V.company_name=="string"&&(v(V.company_name||""),V.logo&&$(J(V.logo)))}catch{}})()},[n,m]),l.useEffect(()=>{(async()=>{try{const M=n?{"Content-Type":"application/json",Authorization:`Bearer ${n}`}:{"Content-Type":"application/json"},[te,Q]=await Promise.all([fetch(`${m}/clients/stats/`,{headers:M}),fetch(`${m}/sales/stats/`,{headers:M})]),V=await te.json(),s=await Q.json();te.ok&&A(V),Q.ok&&F(s)}catch{}})()},[n,m]);const G=d?"w-24":"w-64",_=d?"hidden":"inline",T=d?"absolute left-full ml-2 top-1/2 -translate-y-1/2 whitespace-nowrap px-2 py-1 rounded bg-gray-800 text-white text-xs shadow-lg opacity-0 group-hover:opacity-100 pointer-events-none":"hidden",B=`group relative w-full flex items-center ${d?"justify-center":""} gap-2 px-3 py-2 rounded hover:bg-white/5 transition text-gray-300 hover:text-white`,L="bg-gradient-to-r from-blue-600/20 to-white/5 text-white ring-1 ring-white/10",U=a=>a==="dashboard"?"bg-blue-600/20 text-blue-300":a==="users"?"bg-cyan-600/20 text-cyan-300":a==="inventory"||a==="productos"?"bg-indigo-600/20 text-indigo-300":a==="categorias"?"bg-violet-600/20 text-violet-300":a==="clientes"?"bg-blue-600/20 text-blue-300":a==="ventas"?"bg-emerald-600/20 text-emerald-300":a==="pedidos"?"bg-rose-600/20 text-rose-300":a==="web"?"bg-cyan-600/20 text-cyan-300":"bg-blue-600/20 text-blue-300",se=()=>e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M8 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});return e.jsxs("aside",{className:`${G} shrink-0 bg-gradient-to-b from-gray-950 via-gray-900 to-gray-950 border-r border-white/10 text-gray-200 transition-all duration-200 flex flex-col relative z-50 overflow-y-auto sidebar-scrollbar`,children:[e.jsxs("div",{className:"px-4 py-4 border-b border-white/10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[S?e.jsx("img",{src:S,alt:"Logo",className:"w-8 h-8 rounded object-cover border border-white/20 ring-2 ring-white/10"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold ring-2 ring-white/10",children:(y||"P").charAt(0).toUpperCase()}),e.jsx("div",{className:`${_} text-lg font-semibold text-white`,children:y||"Panel"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>c(a=>!a),className:"p-2 rounded hover:bg-gray-800",title:d?"Expandir":"Colapsar",children:e.jsx(se,{})})})]}),e.jsx("div",{className:"px-4 py-2 border-b border-white/10",children:e.jsxs("div",{className:`${_} text-xs text-gray-300 flex flex-col gap-1`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Panel ",p==="super_admin"?"Super Admin":p==="admin"?"Admin":"Empleado"]}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full border border-white/10 bg-blue-600/15 text-blue-300 text-[11px]",children:p})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{children:"Plan:"}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full border border-white/10 text-[11px] font-medium ${i.code==="basic"?"bg-blue-600/20 text-blue-300":i.code==="medium"?"bg-purple-600/20 text-purple-300":"bg-green-600/20 text-green-300"}`,children:i.name})]})]})}),e.jsxs("nav",{className:"p-2 space-y-1",role:"navigation","aria-label":"Secciones",children:[e.jsxs("button",{className:`${B} ${t==="dashboard"?L:""}`,onClick:()=>r("dashboard"),title:"Dashboard","aria-current":t==="dashboard"?"page":void 0,children:[t==="dashboard"&&e.jsx("span",{className:"absolute left-0 top-0 h-full w-1 bg-blue-500 rounded-r"}),e.jsx("span",{className:`w-12 h-11 rounded-md flex items-center justify-center ${U("dashboard")} ${t==="dashboard"?"ring-1 ring-white/20":""}`,children:e.jsx(C,{name:"dashboard",className:"w-5 h-5"})}),e.jsx("span",{className:_,children:"Dashboard"}),e.jsx("span",{className:T,children:"Dashboard"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:`${B} ${["ventas","caja"].includes(t)?L:""}`,onClick:ee,title:"Ventas",children:[["ventas","caja"].includes(t)&&e.jsx("span",{className:"absolute left-0 top-0 h-full w-1 bg-blue-500 rounded-r"}),e.jsx("span",{className:`w-12 h-11 rounded-md flex items-center justify-center ${U("ventas")} ${["ventas","caja"].includes(t)?"ring-1 ring-white/20":""}`,children:e.jsx(C,{name:"sales",className:"w-5 h-5"})}),e.jsx("span",{className:_,children:"Ventas"}),e.jsx("span",{className:T,children:"Ventas"}),!d&&e.jsx("svg",{className:`w-4 h-4 ml-auto text-gray-400 transition-transform ${u||O?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),u&&d&&e.jsxs("div",{style:{position:"fixed",top:u.top,left:u.left,zIndex:9999},className:"w-56 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 ml-2",children:[e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("ventas"),h(null)},className:`w-full text-left px-4 py-3 hover:bg-white/5 flex items-center gap-3 transition-colors ${t==="ventas"?"text-emerald-400 bg-emerald-600/10":"text-gray-300 hover:text-white"}`,children:[e.jsx(C,{name:"sales",className:"w-4 h-4"}),e.jsx("span",{children:"Nueva Venta"})]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("caja"),h(null)},className:`w-full text-left px-4 py-3 hover:bg-white/5 flex items-center gap-3 transition-colors ${t==="caja"?"text-emerald-400 bg-emerald-600/10":"text-gray-300 hover:text-white"}`,children:[e.jsx(C,{name:"sales",className:"w-4 h-4"}),e.jsx("span",{children:"Caja"})]})]}),O&&!d&&e.jsxs("div",{className:"mt-1 ml-1 space-y-1 bg-black/20 rounded-md p-1",children:[e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("ventas")},className:`w-full text-left px-3 py-2 rounded-md hover:bg-white/5 flex items-center gap-3 transition-colors text-sm ${t==="ventas"?"text-emerald-400 bg-emerald-600/10":"text-gray-400 hover:text-white"}`,children:[e.jsx(C,{name:"sales",className:"w-4 h-4"}),e.jsx("span",{children:"Nueva Venta"})]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("caja")},className:`w-full text-left px-3 py-2 rounded-md hover:bg-white/5 flex items-center gap-3 transition-colors text-sm ${t==="caja"?"text-emerald-400 bg-emerald-600/10":"text-gray-400 hover:text-white"}`,children:[e.jsx(C,{name:"sales",className:"w-4 h-4"}),e.jsx("span",{children:"Caja"})]})]})]}),e.jsxs("button",{className:`${B} ${t==="pedidos"?L:""}`,onClick:()=>r("pedidos"),title:"Pedidos","aria-current":t==="pedidos"?"page":void 0,children:[t==="pedidos"&&e.jsx("span",{className:"absolute left-0 top-0 h-full w-1 bg-blue-500 rounded-r"}),e.jsxs("span",{className:`w-12 h-11 rounded-md flex items-center justify-center ${U("pedidos")} ${t==="pedidos"?"ring-1 ring-white/20":""} relative`,children:[e.jsx(C,{name:"orders",className:"w-5 h-5"}),Number(o||0)>0&&e.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center border border-white/20 notification-badge","aria-label":`${o} notificaciones de pedidos sin leer`,children:Number(o)>99?"99+":Number(o)})]}),e.jsx("span",{className:_,children:"Pedidos"}),e.jsx("span",{className:T,children:"Pedidos"})]}),e.jsxs("button",{className:`${B} ${t==="clientes"?L:""}`,onClick:()=>r("clientes"),title:"Clientes","aria-current":t==="clientes"?"page":void 0,children:[t==="clientes"&&e.jsx("span",{className:"absolute left-0 top-0 h-full w-1 bg-blue-500 rounded-r"}),e.jsx("span",{className:`w-12 h-11 rounded-md flex items-center justify-center ${U("clientes")} ${t==="clientes"?"ring-1 ring-white/20":""}`,children:e.jsx(C,{name:"clients",className:"w-5 h-5"})}),e.jsx("span",{className:_,children:"Clientes"}),e.jsx("span",{className:T,children:"Clientes"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:`${B} ${["productos","categorias"].includes(t)?L:""}`,onClick:Z,title:"Inventario",children:[["productos","categorias"].includes(t)&&e.jsx("span",{className:"absolute left-0 top-0 h-full w-1 bg-blue-500 rounded-r"}),e.jsx("span",{className:`w-12 h-11 rounded-md flex items-center justify-center ${U("inventory")} ${["productos","categorias"].includes(t)?"ring-1 ring-white/20":""}`,children:e.jsx(C,{name:"inventory",className:"w-5 h-5"})}),e.jsx("span",{className:_,children:"Inventario"}),e.jsx("span",{className:T,children:"Inventario"}),!d&&e.jsx("svg",{className:`w-4 h-4 ml-auto text-gray-400 transition-transform ${k||P?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),k&&d&&e.jsxs("div",{style:{position:"fixed",top:k.top,left:k.left,zIndex:9999},className:"w-56 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 ml-2",children:[e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("productos"),N(null)},className:`w-full text-left px-4 py-3 hover:bg-white/5 flex items-center gap-3 transition-colors ${t==="productos"?"text-indigo-400 bg-indigo-600/10":"text-gray-300 hover:text-white"}`,children:[e.jsx(C,{name:"products",className:"w-4 h-4"}),e.jsx("span",{children:"Productos"})]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("categorias"),N(null)},className:`w-full text-left px-4 py-3 hover:bg-white/5 flex items-center gap-3 transition-colors ${t==="categorias"?"text-violet-400 bg-violet-600/10":"text-gray-300 hover:text-white"}`,children:[e.jsx(C,{name:"categories",className:"w-4 h-4"}),e.jsx("span",{children:"Categorías"})]})]}),P&&!d&&e.jsxs("div",{className:"mt-1 ml-1 space-y-1 bg-black/20 rounded-md p-1",children:[e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("productos")},className:`w-full text-left px-3 py-2 rounded-md hover:bg-white/5 flex items-center gap-3 transition-colors text-sm ${t==="productos"?"text-indigo-400 bg-indigo-600/10":"text-gray-400 hover:text-white"}`,children:[e.jsx(C,{name:"products",className:"w-4 h-4"}),e.jsx("span",{children:"Productos"})]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("categorias")},className:`w-full text-left px-3 py-2 rounded-md hover:bg-white/5 flex items-center gap-3 transition-colors text-sm ${t==="categorias"?"text-violet-400 bg-violet-600/10":"text-gray-400 hover:text-white"}`,children:[e.jsx(C,{name:"categories",className:"w-4 h-4"}),e.jsx("span",{children:"Categorías"})]})]})]}),(p==="super_admin"||p==="admin"&&((ae=i==null?void 0:i.features)==null?void 0:ae.user_management))&&e.jsxs("button",{className:`${B} ${t==="users"?L:""}`,onClick:()=>r("users"),title:"Usuarios","aria-current":t==="users"?"page":void 0,children:[t==="users"&&e.jsx("span",{className:"absolute left-0 top-0 h-full w-1 bg-blue-500 rounded-r"}),e.jsx("span",{className:`w-12 h-11 rounded-md flex items-center justify-center ${U("users")} ${t==="users"?"ring-1 ring-white/20":""}`,children:e.jsx(C,{name:"users",className:"w-5 h-5"})}),e.jsx("span",{className:_,children:"Usuarios"}),e.jsx("span",{className:T,children:"Usuarios"})]}),(p==="admin"||p==="super_admin")&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:`${B} ${["web","planes","configuracion"].includes(t)?L:""}`,onClick:K,title:"Configuración",children:[["web","planes","configuracion"].includes(t)&&e.jsx("span",{className:"absolute left-0 top-0 h-full w-1 bg-blue-500 rounded-r"}),e.jsx("span",{className:`w-12 h-11 rounded-md flex items-center justify-center ${U("web")} ${["web","planes","configuracion"].includes(t)?"ring-1 ring-white/20":""}`,children:e.jsx(C,{name:"settings",className:"w-5 h-5"})}),e.jsx("span",{className:_,children:"Configuración"}),e.jsx("span",{className:T,children:"Configuración"}),!d&&e.jsx("svg",{className:`w-4 h-4 ml-auto text-gray-400 transition-transform ${W||j?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),W&&d&&e.jsxs("div",{style:{position:"fixed",top:W.top,left:W.left,zIndex:9999},className:"w-56 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 ml-2",children:[(p==="super_admin"||p==="admin"&&((ne=i==null?void 0:i.features)==null?void 0:ne.web_store))&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("web"),b(null)},className:`w-full text-left px-4 py-3 hover:bg-white/5 flex items-center gap-3 transition-colors ${t==="web"?"text-blue-400 bg-blue-600/10":"text-gray-300 hover:text-white"}`,children:[e.jsx(C,{name:"web",className:"w-4 h-4"}),e.jsx("span",{children:"Página web"})]}),p==="super_admin"&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("planes"),b(null)},className:`w-full text-left px-4 py-3 hover:bg-white/5 flex items-center gap-3 transition-colors ${t==="planes"?"text-purple-400 bg-purple-600/10":"text-gray-300 hover:text-white"}`,children:[e.jsx(C,{name:"plans",className:"w-4 h-4"}),e.jsx("span",{children:"Planes"})]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("configuracion"),b(null)},className:`w-full text-left px-4 py-3 hover:bg-white/5 flex items-center gap-3 transition-colors ${t==="configuracion"?"text-blue-400 bg-blue-600/10":"text-gray-300 hover:text-white"}`,children:[e.jsx(C,{name:"settings",className:"w-4 h-4"}),e.jsx("span",{children:"General"})]})]}),j&&!d&&e.jsxs("div",{className:"mt-1 ml-1 space-y-1 bg-black/20 rounded-md p-1",children:[(p==="super_admin"||p==="admin"&&((oe=i==null?void 0:i.features)==null?void 0:oe.web_store))&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("web")},className:`w-full text-left px-3 py-2 rounded-md hover:bg-white/5 flex items-center gap-3 transition-colors text-sm ${t==="web"?"text-blue-400 bg-blue-600/10":"text-gray-400 hover:text-white"}`,children:[e.jsx(C,{name:"web",className:"w-4 h-4"}),e.jsx("span",{children:"Página web"})]}),p==="super_admin"&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("planes")},className:`w-full text-left px-3 py-2 rounded-md hover:bg-white/5 flex items-center gap-3 transition-colors text-sm ${t==="planes"?"text-purple-400 bg-purple-600/10":"text-gray-400 hover:text-white"}`,children:[e.jsx(C,{name:"plans",className:"w-4 h-4"}),e.jsx("span",{children:"Planes"})]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),r("configuracion")},className:`w-full text-left px-3 py-2 rounded-md hover:bg-white/5 flex items-center gap-3 transition-colors text-sm ${t==="configuracion"?"text-blue-400 bg-blue-600/10":"text-gray-400 hover:text-white"}`,children:[e.jsx(C,{name:"settings",className:"w-4 h-4"}),e.jsx("span",{children:"General"})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 p-2 bg-gray-950/95 border-t border-white/10",children:e.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 rounded bg-white/5 hover:bg-white/10 text-gray-200 border border-white/10 transition",onClick:x,title:"Cerrar sesión",children:[e.jsx("span",{className:"w-8 h-8 rounded-md flex items-center justify-center bg-white/10 text-red-500 border border-white/10",children:e.jsx(C,{name:"logout"})}),e.jsx("span",{className:_,children:"Cerrar sesión"}),e.jsx("span",{className:T,children:"Cerrar sesión"})]})})]})},Pe=({token:t,apiBase:r,role:x,createSignal:p=0,openSaFormSignal:o=0})=>{const[n,m]=l.useState([]),[f,i]=l.useState(!1),[d,c]=l.useState(null),[y,v]=l.useState({username:"",password:"",first_name:"",last_name:"",email:"",department:"",position:""}),[S,$]=l.useState(null),[w,A]=l.useState({first_name:"",last_name:"",email:"",department:"",position:"",password:"",phone:""}),[X,F]=l.useState(!1),[W,b]=l.useState(""),[k,N]=l.useState(""),[u,h]=l.useState("admin"),[j,z]=l.useState(!1),[P,I]=l.useState(null),[O,Y]=l.useState([]),[K,Z]=l.useState(""),[ee,J]=l.useState(!1),G={username:"Usuario",password:"Contraseña",first_name:"Nombre",last_name:"Apellido",email:"Correo electrónico",department:"Departamento",position:"Cargo"},_=s=>({"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}}),T=async()=>{c(null),i(!0);try{const s=await fetch(`${r}/users/api/users/?page_size=1000`,{headers:_(t)}),g=await s.json();if(!s.ok)throw new Error(g.detail||"No se pudieron cargar usuarios");const R=Array.isArray(g)?g:Array.isArray(g.results)?g.results:Array.isArray(g.items)?g.items:[];m(R)}catch(s){c({type:"error",text:s.message})}finally{i(!1)}};l.useEffect(()=>{t&&(x==="admin"||x==="super_admin")&&T()},[t,x]),l.useEffect(()=>{t&&x==="super_admin"&&fetch(`${r}/users/api/admin/tenants/`,{headers:_(t)}).then(s=>s.json().then(g=>({ok:s.ok,d:g}))).then(({ok:s,d:g})=>{s&&Array.isArray(g)&&Y(g)}).catch(()=>{})},[t,x]),l.useEffect(()=>{x==="admin"&&p>0&&(v({username:"",password:"",first_name:"",last_name:"",email:"",department:"",position:""}),F(!0))},[p,x]),l.useEffect(()=>{x==="super_admin"&&o>0&&(h("employee"),J(!0))},[o,x]);const B=s=>v(g=>({...g,[s.target.name]:s.target.value})),L=s=>A(g=>({...g,[s.target.name]:s.target.value})),U=async s=>{s.preventDefault(),c(null),i(!0);try{const g={...y,role:"employee"},R=await fetch(`${r}/users/api/users/`,{method:"POST",headers:_(t),body:JSON.stringify(g)});let H=null;try{H=await R.json()}catch{}if(!R.ok)throw new Error(H&&(H.detail||H.message)||`Error ${R.status}`);c({type:"success",text:`Empleado ${H.username||y.username} creado`}),v({username:"",password:"",first_name:"",last_name:"",email:"",department:"",position:""}),setTimeout(()=>{T()},400)}catch(g){c({type:"error",text:g.message})}finally{i(!1)}},se=async s=>{c(null);try{const g=await fetch(`${r}/users/api/users/${s}/`,{method:"DELETE",headers:_(t)}),R=await g.json();if(!g.ok)throw new Error(R.detail||R.message||"No se pudo eliminar");c({type:"success",text:"Empleado eliminado"}),T()}catch(g){c({type:"error",text:g.message})}},ae=s=>{c(null),$(s),A({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",department:s.department||"",position:s.position||"",password:"",phone:""})},ne=async s=>{if(s.preventDefault(),c(null),!!S)try{const g=await fetch(`${r}/users/api/users/${S.id}/`,{method:"PATCH",headers:_(t),body:JSON.stringify(w)}),R=await g.json();if(!g.ok)throw new Error(R.detail||"No se pudo actualizar");c({type:"success",text:"Empleado actualizado"}),$(null),T()}catch(g){c({type:"error",text:g.message})}},oe=async s=>{s.preventDefault(),I(null),z(!0);try{const g={username:W,password:k,role:u,first_name:w.first_name||"",last_name:w.last_name||"",email:w.email||"",phone:w.phone||"",department:w.department||"",position:w.position||""};u==="employee"&&(g.tenant_id=K||void 0);const R=await fetch(`${r}/users/api/users/`,{method:"POST",headers:_(t),body:JSON.stringify(g)}),H=await R.json();if(!R.ok)throw new Error(H.detail||"No se pudo crear el usuario");I({type:"success",text:`Usuario ${H.username} creado como ${u}.`}),b(""),N(""),h("admin"),Z(""),A({first_name:"",last_name:"",email:"",department:"",position:"",password:"",phone:""})}catch(g){I({type:"error",text:g.message})}finally{z(!1)}};if(x!=="admin"&&x!=="super_admin")return null;const a=n.filter(s=>s.role==="employee"),M=a.length,te=a.filter(s=>!!s.email).length,Q=a.filter(s=>!!s.department).length,V=new Set(a.map(s=>s.department).filter(Boolean)).size;return e.jsxs("div",{className:"space-y-4",children:[d&&e.jsx("div",{className:`p-3 rounded text-sm ${d.type==="success"?"bg-green-600/20 text-green-200 border border-green-500/40":"bg-red-600/20 text-red-200 border border-red-500/40"}`,children:d.text}),x==="super_admin"&&ee&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded p-4 w-full max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Crear Administrador o Empleado"}),e.jsx("button",{onClick:()=>J(!1),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cerrar"})]}),P&&e.jsx("div",{className:`mb-3 p-3 rounded text-sm ${P.type==="success"?"bg-green-600/20 text-green-200 border border-green-500/40":"bg-red-600/20 text-red-200 border border-red-500/40"}`,children:P.text}),e.jsxs("form",{onSubmit:oe,className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:W,onChange:s=>b(s.target.value),required:!0,minLength:4,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Usuario"}),e.jsx("input",{type:"password",value:k,onChange:s=>N(s.target.value),required:!0,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Contraseña"}),e.jsxs("select",{value:u,onChange:s=>h(s.target.value),className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"employer",children:"Empleador"}),e.jsx("option",{value:"employee",children:"Empleado"})]}),u==="employee"&&e.jsxs("select",{value:K,onChange:s=>Z(s.target.value),className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccione tenant (administrador)"}),O.map(s=>e.jsxs("option",{value:s.id,children:[s.admin_username," (",s.id,")"]},s.id))]}),e.jsx("input",{type:"text",name:"first_name",value:w.first_name,onChange:L,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Nombre"}),e.jsx("input",{type:"text",name:"last_name",value:w.last_name,onChange:L,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Apellido"}),e.jsx("input",{type:"email",name:"email",value:w.email,onChange:L,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Correo electrónico"}),e.jsx("input",{type:"text",name:"phone",value:w.phone||"",onChange:L,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Teléfono"}),e.jsx("input",{type:"text",name:"department",value:w.department,onChange:L,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Departamento"}),e.jsx("input",{type:"text",name:"position",value:w.position,onChange:L,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Cargo"}),e.jsxs("div",{className:"sm:col-span-2 md:col-span-3 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>J(!1),className:"px-3 py-2 rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:j,className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-medium transition disabled:opacity-50",children:j?"Creando...":"Crear"})]})]})]})}),x==="super_admin"&&e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:()=>J(s=>!s),className:"px-3 py-2 rounded bg-gray-600 hover:bg-gray-700 text-white",children:ee?"Ocultar formulario":"Mostrar formulario"})}),(x==="admin"||x==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl bg-white/5 backdrop-blur-sm border border-white/10 p-4",children:[e.jsx("div",{className:"text-white font-medium mb-3",children:"Estadísticas"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(E,{label:"Empleados",value:M,icon:"users",tone:"cyan"}),e.jsx(E,{label:"Con correo",value:te,icon:"users",tone:"blue"}),e.jsx(E,{label:"Con departamento",value:Q,icon:"categories",tone:"violet"}),e.jsx(E,{label:"Departamentos",value:V,icon:"categories",tone:"indigo"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 via-gray-850 to-gray-900 border border-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-white font-medium",children:x==="super_admin"?"Usuarios":"Empleados"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:T,className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Recargar"})})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-white/10",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/10",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-800 to-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-200",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-200",children:"Nombre"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-200",children:"Correo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-200",children:"Departamento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-200",children:"Cargo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-200",children:"Rol"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-200",children:"Acciones"})]})}),e.jsxs("tbody",{className:"bg-gray-800/40 divide-y divide-white/10",children:[n.map(s=>e.jsxs("tr",{className:"hover:bg-gray-700/50 transition",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:s.username}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-300",children:[s.first_name," ",s.last_name]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:s.email}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:s.department||""}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:s.position||""}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] border border-white/10 ${s.role==="employee"?"bg-blue-600/20 text-blue-300":s.role==="admin"?"bg-indigo-600/20 text-indigo-300":s.role==="super_admin"?"bg-emerald-600/20 text-emerald-300":"bg-violet-600/20 text-violet-300"}`,children:s.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.role==="employee"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ae(s),className:"px-2 py-1 text-xs rounded bg-indigo-600 hover:bg-indigo-700 text-white",children:"Editar"}),e.jsx("button",{onClick:()=>se(s.id),className:"px-2 py-1 text-xs rounded bg-red-600 hover:bg-red-700 text-white",children:"Eliminar"})]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"—"})})]},s.id)),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-3 text-sm text-gray-300",children:"No hay empleados registrados."})})]})]})})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded p-4 w-full max-w-lg",children:[e.jsxs("div",{className:"text-white font-medium mb-3",children:["Editar usuario: ",S.username]}),e.jsxs("form",{onSubmit:ne,className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[["first_name","last_name","email","department","position","password"].map(s=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-300",children:G[s]}),e.jsx("input",{type:s==="password"?"password":s==="email"?"email":"text",name:s,value:w[s],onChange:L,className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:G[s]})]},s)),e.jsxs("div",{className:"col-span-1 md:col-span-2 flex items-center justify-end gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>$(null),className:"px-3 py-2 rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white",children:"Guardar cambios"})]})]})]})}),X&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded p-4 w-full max-w-lg",children:[e.jsx("div",{className:"text-white font-medium mb-3",children:"Nuevo usuario"}),e.jsxs("form",{onSubmit:s=>{U(s),f||F(!1)},className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[["username","password","first_name","last_name","email","department","position"].map(s=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-300",children:G[s]}),e.jsx("input",{type:s==="password"?"password":s==="email"?"email":"text",name:s,value:y[s],onChange:B,required:s==="username"||s==="password",className:"px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:G[s]})]},s)),e.jsxs("div",{className:"col-span-1 md:grid-cols-2 flex items-center justify-end gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>F(!1),className:"px-3 py-2 rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:f,className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50",children:f?"Creando...":"Crear usuario"})]})]})]})})]})},Le=D.lazy(()=>q(()=>import("./ProductosManager-j2k-BqL5.js"),__vite__mapDeps([0,1]),import.meta.url)),Ae=D.lazy(()=>q(()=>import("./ProductFormPage-CFrpSRoW.js"),__vite__mapDeps([2,1]),import.meta.url)),Te=D.lazy(()=>q(()=>import("./CategoriesManager-DIjAkLn2.js"),__vite__mapDeps([3,1]),import.meta.url)),Me=D.lazy(()=>q(()=>import("./SalesPage-21lp5ASf.js"),__vite__mapDeps([4,1]),import.meta.url)),Ie=D.lazy(()=>q(()=>import("./OrdersPage-vomNhAPZ.js"),__vite__mapDeps([5,1]),import.meta.url)),Oe=D.lazy(()=>q(()=>import("./ClientsPage-CBdqgCqA.js"),__vite__mapDeps([6,1]),import.meta.url)),Re=D.lazy(()=>q(()=>import("./WebPageManager-BV3STy12.js"),__vite__mapDeps([7,1]),import.meta.url)),We=D.lazy(()=>q(()=>import("./PlansManager-BxS7oxl0.js"),__vite__mapDeps([8,1]),import.meta.url)),De=D.lazy(()=>q(()=>import("./ConfigPage-CINIdEZB.js"),__vite__mapDeps([9,1]),import.meta.url)),ze=D.lazy(()=>q(()=>import("./CashboxPage-CZTWHVtj.js"),__vite__mapDeps([10,1]),import.meta.url)),Be=({token:t,role:r,userId:x,onSignOut:p})=>{const o=pe,[n,m]=l.useState("dashboard"),[f,i]=l.useState(0),[d,c]=l.useState(!1),[y,v]=l.useState(null),[S,$]=l.useState({usersCount:0,productsCount:0,productsActive:0,categoriesCount:0,clientsTotal:0,ordersTotal:0,clientsNewMonth:0,salesToday:0,salesTotal:0,salesAmount:0,statusCounts:{pending:0,shipped:0,delivered:0,canceled:0}}),[w,A]=l.useState([3,5,4,6,8,7,9]),[X,F]=l.useState([5,3,6,2,4,7]),[W,b]=l.useState([]),[k,N]=l.useState([]);return l.useEffect(()=>{const u={"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}};Promise.all([fetch(`${o}/users/api/users/`,{headers:u}).then(h=>h.json().then(j=>({ok:h.ok,d:j}))).catch(()=>({ok:!1,d:[]})),fetch(`${o}/products/`,{headers:u}).then(h=>h.json().then(j=>({ok:h.ok,d:j}))).catch(()=>({ok:!1,d:[]})),fetch(`${o}/products/categories/?page_size=1`,{headers:u}).then(h=>h.json().then(j=>({ok:h.ok,d:j}))).catch(()=>({ok:!1,d:{count:0}})),fetch(`${o}/clients/stats/`,{headers:u}).then(h=>h.json().then(j=>({ok:h.ok,d:j}))).catch(()=>({ok:!1,d:{total:0}})),fetch(`${o}/sales/list/?page_size=5`,{headers:u}).then(h=>h.json().then(j=>({ok:h.ok,d:j}))).catch(()=>({ok:!1,d:{results:[]}})),fetch(`${o}/sales/stats/`,{headers:u}).then(h=>h.json().then(j=>({ok:h.ok,d:j}))).catch(()=>({ok:!1,d:{today_sales:0}}))]).then(([h,j,z,P,I,O])=>{const Y=h.ok&&Array.isArray(h.d)?h.d.length:0,K=j.ok&&Array.isArray(j.d)?j.d:[],Z=K.length,ee=K.filter(se=>!!se.active).length,J=z.ok?Number(z.d.count||0):0,G=P.ok?Number(P.d.total||0):0,_=P.ok?Number(P.d.new_this_month||0):0,T=I.ok?Number(I.d.count||0):0,B=O.ok?Number(O.d.today_sales||0):0,L=O.ok?Number(O.d.total_sales||0):0,U=O.ok?Number(O.d.total_amount||0):0;b(I.ok&&Array.isArray(I.d.results)?I.d.results:[]),N([]),$({usersCount:Y,productsCount:Z,productsActive:ee,categoriesCount:J,clientsTotal:G,ordersTotal:T,clientsNewMonth:_,salesToday:B,salesTotal:L,salesAmount:U,statusCounts:{pending:0,shipped:0,delivered:0,canceled:0}})}).catch(()=>{})},[t]),l.useEffect(()=>{let u=!0;const h={"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}},j=()=>{fetch(`${o}/sales/notifications/count/`,{headers:h}).then(P=>P.json()).then(P=>{u&&i(Number(P.unread||0))}).catch(()=>{})};j();const z=setInterval(j,3e3);return()=>{u=!1,clearInterval(z)}},[t]),e.jsxs("div",{className:"h-full bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950 flex",children:[e.jsx(Ee,{view:n,setView:u=>{if(c(!0),m(u),setTimeout(()=>c(!1),800),u==="pedidos"){const h={"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}};fetch(`${o}/sales/notifications/read/`,{method:"POST",headers:h}).then(()=>i(0)).catch(()=>i(0))}},onSignOut:p,role:r,orderNotif:f,token:t,apiBase:o}),e.jsxs("main",{className:"flex-1 p-6 space-y-6 relative",children:[d&&e.jsx("div",{className:"absolute inset-0 z-40 bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"bg-gray-800/80 border border-white/10 rounded-xl p-5 shadow-xl text-center",children:[e.jsx("div",{className:"mx-auto w-10 h-10 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"mt-2 text-white text-sm",children:"Cargando vista..."})]})}),e.jsxs("div",{className:`${d?"opacity-0":"opacity-100"} transition-opacity duration-300`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-semibold text-white",children:n==="dashboard"?"Dashboard":n==="users"?"Gestión de usuarios":n==="productos"?"Productos":n==="categorias"?"Categorías":n==="clientes"?"Clientes":n==="ventas"?"Ventas":n==="web"?"Página web":n==="planes"?"Planes de Suscripción":n==="configuracion"?"Configuración":n==="caja"?"Caja":"Pedidos"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Rol: ",e.jsx("span",{className:"font-medium",children:r})]})]}),n==="dashboard"&&e.jsx($e,{stats:S,seriesA:w,seriesB:X,recentOrders:W,topProducts:k}),e.jsxs(D.Suspense,{fallback:e.jsx("div",{className:"text-white text-sm",children:"Cargando módulo..."}),children:[n==="users"&&e.jsx(Pe,{token:t,apiBase:o,role:r}),n==="productos"&&e.jsx(Le,{token:t,apiBase:o,onCreate:()=>{v(null),m("producto_form")},onEdit:u=>{v(u),m("producto_form")}}),n==="producto_form"&&e.jsx(Ae,{token:t,apiBase:o,product:y,onCancel:()=>m("productos"),onSaved:()=>m("productos")}),n==="categorias"&&e.jsx(Te,{token:t,apiBase:o,role:r}),n==="clientes"&&e.jsx(Oe,{token:t,apiBase:o}),n==="ventas"&&e.jsx(Me,{token:t,apiBase:o,onSaleCreated:()=>i(u=>u+1)}),n==="web"&&e.jsx(Re,{token:t,apiBase:o,adminId:x,role:r,setView:u=>m(u),setProductEditing:u=>{v(u),m("producto_form")}}),n==="pedidos"&&e.jsx(Ie,{token:t,apiBase:o}),n==="planes"&&e.jsx(We,{token:t}),n==="configuracion"&&e.jsx(De,{token:t,apiBase:o}),n==="caja"&&e.jsx(ze,{token:t,apiBase:o})]})]})]})]})},Ue=""+new URL("logo-cYiFNIKE.png",import.meta.url).href,qe=()=>e.jsx("div",{className:"h-8 bg-gray-950 flex items-center px-3 select-none",style:{WebkitAppRegion:"drag"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:Ue,alt:"Logo",className:"w-4 h-4"}),e.jsx("span",{className:"text-gray-400 text-xs font-medium",children:"Localix Dashboard"})]})}),Ve=()=>{const[t,r]=l.useState(""),[x,p]=l.useState(""),[o,n]=l.useState(!1),[m,f]=l.useState(null),[i,d]=l.useState(null),[c,y]=l.useState(null),[v,S]=l.useState(null),[$,w]=l.useState(null),A=pe,X=Ce;l.useEffect(()=>{try{const b=localStorage.getItem("globetrek_access_token"),k=localStorage.getItem("globetrek_refresh_token");b&&d(b),k&&S(k)}catch{}},[]),l.useEffect(()=>{const b=()=>{fetch(`${A}/health/`).catch(()=>{})};b();const k=setInterval(b,5*60*1e3);return()=>clearInterval(k)},[]),l.useEffect(()=>{let b=null;return v&&(b=setInterval(async()=>{if(v)try{const N=await fetch(`${A}/users/api/auth/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:v})}),u=await N.json();if(N.ok&&u.access){d(u.access);try{localStorage.setItem("globetrek_access_token",u.access)}catch{}if(u.refresh){S(u.refresh);try{localStorage.setItem("globetrek_refresh_token",u.refresh)}catch{}}}}catch{}},25*60*1e3)),()=>{b&&clearInterval(b)}},[v]);const F=async b=>{b.preventDefault(),n(!0),f(null);try{const k=await fetch(`${A}/users/api/auth/login/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:x})}),N=await k.json();if(!k.ok)throw new Error(N.detail||"Credenciales inválidas");d(N.access),S(N.refresh||null);try{N.access&&localStorage.setItem("globetrek_access_token",N.access),N.refresh&&localStorage.setItem("globetrek_refresh_token",N.refresh)}catch{}f({type:"success",text:"Inicio de sesión exitoso"});try{const u=await fetch(`${A}/users/api/auth/me/`,{method:"GET",headers:X(N.access)}),h=await u.json();if(!u.ok)throw new Error(h.detail||"No se pudo obtener el perfil");y(h.role),w(h.id)}catch(u){f({type:"error",text:u.message})}}catch(k){f({type:"error",text:k.message})}finally{n(!1)}},W=()=>{d(null),y(null),S(null),r(""),p(""),f({type:"success",text:"Sesión cerrada"});try{localStorage.removeItem("globetrek_access_token"),localStorage.removeItem("globetrek_refresh_token")}catch{}};return e.jsxs("div",{className:"flex flex-col h-screen overflow-hidden",children:[e.jsx(qe,{}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-900",children:i?e.jsx(Be,{token:i,role:c,userId:Number($),onSignOut:W}):e.jsx("div",{className:"min-h-full bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-6",children:e.jsxs("div",{className:"w-full max-w-md bg-white/10 backdrop-blur rounded-xl shadow-lg border border-white/20 p-8",children:[e.jsx("h1",{className:"text-2xl font-semibold text-white mb-6 text-center",children:"Acceso a GlobeTrek"}),m&&e.jsx("div",{className:`mb-4 p-3 rounded text-sm ${m.type==="success"?"bg-green-600/20 text-green-200 border border-green-500/40":"bg-red-600/20 text-red-200 border border-red-500/40"}`,children:m.text}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-200 mb-1",children:"Usuario"}),e.jsx("input",{type:"text",value:t,onChange:b=>r(b.target.value),required:!0,minLength:4,className:"w-full px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tu usuario"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-200 mb-1",children:"Contraseña"}),e.jsx("input",{type:"password",value:x,onChange:b=>p(b.target.value),required:!0,className:"w-full px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tu contraseña"})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full py-2.5 rounded bg-blue-600 hover:bg-blue-700 text-white font-medium transition disabled:opacity-50",children:o?"Accediendo...":"Iniciar sesión"})]}),e.jsxs("p",{className:"mt-6 text-center text-xs text-gray-400",children:["© ",new Date().getFullYear()," GlobeTrek"]})]})})})]})};we.createRoot(document.getElementById("root")).render(e.jsx(D.StrictMode,{children:e.jsx(Ve,{})}));export{pe as A,e as j,l as r};
