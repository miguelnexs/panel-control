import{r as a,j as e}from"./index-DLBiUv4k.js";import"./vendor-BtP0CW_r.js";const X=({token:i,apiBase:n})=>{const[E,F]=a.useState([]),[v,x]=a.useState(null),[b,k]=a.useState(!1),[w,p]=a.useState(1),[m,q]=a.useState(10),[D,R]=a.useState(0),[y,V]=a.useState("-created_at"),[j,G]=a.useState(""),[l,c]=a.useState({full_name:"",cedula:"",email:"",address:""}),[d,P]=a.useState({}),[f,H]=a.useState({total:0,new_this_month:0,top_cities:[]}),[I,C]=a.useState(!1),[u,O]=a.useState(null),[z,A]=a.useState([]),[Z,M]=a.useState(!1),[T,S]=a.useState(null),[h,g]=a.useState({full_name:"",cedula:"",email:"",address:""}),o=s=>({...s?{Authorization:`Bearer ${s}`}:{}}),N=async()=>{x(null),k(!0);try{const s=new URLSearchParams({page:String(w),page_size:String(m)});j&&s.set("search",j),y&&s.set("ordering",y);const t=await fetch(`${n}/clients/?${s.toString()}`,{headers:o(i)}),r=await t.json();if(!t.ok)throw new Error(r.detail||"No se pudieron cargar clientes");F(Array.isArray(r.results)?r.results:[]),R(Number(r.count||0))}catch(s){x({type:"error",text:s.message})}finally{k(!1)}},_=async()=>{try{const s=await fetch(`${n}/clients/stats/`,{headers:o(i)}),t=await s.json();s.ok&&H(t)}catch{}};a.useEffect(()=>{i&&(N(),_())},[i,w,m,j,y]);const J=()=>{const s={};return(!l.full_name||l.full_name.trim().length<3)&&(s.full_name="Nombre obligatorio"),/^[0-9]{6,12}$/.test(l.cedula||"")||(s.cedula="Cédula 6-12 dígitos"),/^\S+@\S+\.\S+$/.test(l.email||"")||(s.email="Correo inválido"),(!l.address||l.address.trim().length<5)&&(s.address="Dirección obligatoria"),P(s),Object.keys(s).length===0},U=async s=>{if(s.preventDefault(),x(null),!!J())try{const t=new FormData;t.append("full_name",l.full_name),t.append("cedula",l.cedula),t.append("email",l.email),t.append("address",l.address);const r=await fetch(`${n}/clients/`,{method:"POST",headers:o(i),body:t}),$=await r.json();if(!r.ok)throw new Error($.detail||"No se pudo registrar el cliente");x({type:"success",text:"Cliente registrado"}),c({full_name:"",cedula:"",email:"",address:""}),C(!1),N(),_()}catch(t){x({type:"error",text:t.message})}},L=a.useMemo(()=>Math.max(1,Math.ceil(D/m)),[D,m]),K=({data:s})=>{const t=Math.max(...s.map(r=>r.count||0),1);return e.jsx("div",{className:"flex items-end gap-2 h-16",children:s.map((r,$)=>e.jsx("div",{className:"w-4 bg-blue-500/70",style:{height:`${r.count/t*100}%`},title:`${r.label}: ${r.count}`},$))})};return e.jsxs("div",{className:"space-y-4 relative",children:[v&&e.jsx("div",{className:`p-3 rounded text-sm ${v.type==="success"?"bg-green-600/20 text-green-200 border border-green-500/40":"bg-red-600/20 text-red-200 border border-red-500/40"}`,children:v.text}),b&&e.jsx("div",{className:"absolute inset-0 z-50 bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"bg-gray-800/80 border border-white/10 rounded-xl p-6 shadow-xl text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"mt-3 text-white font-medium",children:"Cargando datos..."}),e.jsx("div",{className:"text-xs text-gray-300",children:"Por favor espera"})]})}),e.jsx("div",{className:`space-y-4 ${b?"opacity-0":"opacity-100"} transition-opacity duration-300`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Total clientes"}),e.jsx("div",{className:"text-base text-white font-semibold",children:f.total})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Nuevos este mes"}),e.jsx("div",{className:"text-base text-white font-semibold",children:f.new_this_month})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Top ciudades"}),e.jsx(K,{data:f.top_cities})]}),e.jsxs("div",{className:"bg-gray-800/60 border border-white/10 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Nuevos hoy"}),e.jsx("div",{className:"text-base text-white font-semibold",children:f.new_today||0})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Clientes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{c({full_name:"",cedula:"",email:"",address:""}),P({}),C(!0)},className:"px-2 py-1 text-xs rounded bg-blue-600 hover:bg-blue-700 text-white",children:"Nuevo cliente"}),e.jsx("input",{type:"text",value:j,onChange:s=>{p(1),G(s.target.value)},placeholder:"Buscar...",className:"px-2 py-1 text-xs rounded bg-gray-700 text-white border border-gray-600"}),e.jsxs("select",{value:y,onChange:s=>V(s.target.value),className:"px-2 py-1 text-xs rounded bg-gray-700 text-white border border-gray-600",children:[e.jsx("option",{value:"full_name",children:"Nombre A-Z"}),e.jsx("option",{value:"-full_name",children:"Nombre Z-A"}),e.jsx("option",{value:"cedula",children:"Cédula"}),e.jsx("option",{value:"email",children:"Correo"}),e.jsx("option",{value:"-created_at",children:"Más recientes"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[e.jsx("thead",{className:"bg-gray-800 text-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"Nombre"}),e.jsx("th",{className:"px-3 py-2",children:"Cédula"}),e.jsx("th",{className:"px-3 py-2",children:"Correo"}),e.jsx("th",{className:"px-3 py-2",children:"Dirección"}),e.jsx("th",{className:"px-3 py-2",children:"Acciones"})]})}),e.jsxs("tbody",{children:[E.map(s=>e.jsxs("tr",{className:"border-t border-gray-700",children:[e.jsx("td",{className:"px-3 py-2",children:s.full_name}),e.jsx("td",{className:"px-3 py-2",children:s.cedula}),e.jsx("td",{className:"px-3 py-2",children:s.email}),e.jsx("td",{className:"px-3 py-2 whitespace-pre-wrap",children:s.address}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{try{M(!0);const t=await fetch(`${n}/clients/orders/${s.id}/`,{headers:o(i)}),r=await t.json();t.ok&&(O(r.client),A(r.orders||[]))}catch{}finally{M(!1)}},className:"px-2 py-1 text-xs rounded bg-indigo-600 hover:bg-indigo-700 text-white",children:"Ver"}),e.jsx("button",{onClick:()=>{S(s),g({full_name:s.full_name||"",cedula:s.cedula||"",email:s.email||"",address:s.address||""})},className:"px-2 py-1 text-xs rounded bg-yellow-600 hover:bg-yellow-700 text-white",children:"Editar"}),e.jsx("button",{onClick:async()=>{if(confirm("Eliminar cliente?"))try{(await fetch(`${n}/clients/${s.id}/`,{method:"DELETE",headers:o(i)})).ok&&(N(),_())}catch{}},className:"px-2 py-1 text-xs rounded bg-red-600 hover:bg-red-700 text-white",children:"Eliminar"})]})})]},s.id)),E.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-4 text-center text-gray-400",colSpan:5,children:"No hay clientes registrados."})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-gray-300",children:[e.jsxs("div",{children:["Página ",w," de ",L]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>p(s=>Math.max(1,s-1)),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Anterior"}),e.jsx("button",{onClick:()=>p(s=>Math.min(L,s+1)),className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Siguiente"}),e.jsx("select",{value:m,onChange:s=>{q(Number(s.target.value)),p(1)},className:"px-2 py-1 text-xs rounded bg-gray-700 text-white border border-gray-600",children:[10,20,50].map(s=>e.jsxs("option",{value:s,children:[s,"/página"]},s))})]})]})]})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded p-4 w-full max-w-lg",children:[e.jsx("div",{className:"text-white font-medium mb-3",children:"Registrar cliente"}),e.jsxs("form",{onSubmit:U,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-200 text-sm mb-1",children:"Nombre completo"}),e.jsx("input",{type:"text",value:l.full_name,onChange:s=>c(t=>({...t,full_name:s.target.value})),required:!0,className:`w-full px-3 py-2 rounded bg-gray-700 text-white border ${d.full_name?"border-red-600":"border-gray-600"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),d.full_name&&e.jsx("div",{className:"mt-1 text-xs text-red-300",children:d.full_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-200 text-sm mb-1",children:"Cédula"}),e.jsx("input",{type:"text",value:l.cedula,onChange:s=>c(t=>({...t,cedula:s.target.value})),required:!0,className:`w-full px-3 py-2 rounded bg-gray-700 text-white border ${d.cedula?"border-red-600":"border-gray-600"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),d.cedula&&e.jsx("div",{className:"mt-1 text-xs text-red-300",children:d.cedula})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-200 text-sm mb-1",children:"Correo electrónico"}),e.jsx("input",{type:"email",value:l.email,onChange:s=>c(t=>({...t,email:s.target.value})),required:!0,className:`w-full px-3 py-2 rounded bg-gray-700 text-white border ${d.email?"border-red-600":"border-gray-600"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),d.email&&e.jsx("div",{className:"mt-1 text-xs text-red-300",children:d.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-200 text-sm mb-1",children:"Dirección"}),e.jsx("textarea",{value:l.address,onChange:s=>c(t=>({...t,address:s.target.value})),required:!0,className:`w-full px-3 py-2 rounded bg-gray-700 text-white border ${d.address?"border-red-600":"border-gray-600"} focus:outline-none focus:ring-2 focus:ring-blue-500`,rows:3}),d.address&&e.jsx("div",{className:"mt-1 text-xs text-red-300",children:d.address})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>C(!1),className:"px-3 py-2 rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:b,className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50",children:b?"Guardando...":"Registrar"})]})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded p-4 w-full max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Detalle del cliente"}),e.jsx("button",{onClick:()=>{O(null),A([])},className:"px-2 py-1 text-xs rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cerrar"})]}),Z&&e.jsx("div",{className:"mb-3 p-3 rounded bg-white/5 border border-white/10 text-sm text-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{children:"Cargando detalle del cliente..."})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-200 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Nombre"}),e.jsx("div",{className:"font-medium",children:u.full_name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Cédula"}),e.jsx("div",{className:"font-medium",children:u.cedula})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Correo"}),e.jsx("div",{className:"font-medium",children:u.email})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Dirección"}),e.jsx("div",{className:"font-medium whitespace-pre-wrap",children:u.address})]})]}),e.jsx("div",{className:"text-white font-medium mb-2",children:"Pedidos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs text-left text-gray-300",children:[e.jsx("thead",{className:"bg-gray-800 text-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"Orden"}),e.jsx("th",{className:"px-3 py-2",children:"Estado"}),e.jsx("th",{className:"px-3 py-2",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2",children:"Total"}),e.jsx("th",{className:"px-3 py-2",children:"Items"})]})}),e.jsxs("tbody",{children:[z.map(s=>e.jsxs("tr",{className:"border-t border-gray-700",children:[e.jsx("td",{className:"px-3 py-2",children:s.order_number}),e.jsx("td",{className:"px-3 py-2",children:s.status}),e.jsx("td",{className:"px-3 py-2",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:"px-3 py-2",children:Number(s.total_amount).toLocaleString("es-CO",{style:"currency",currency:"COP"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("ul",{className:"list-disc pl-4",children:s.items.map((t,r)=>e.jsxs("li",{children:[t.product,t.color?` (${t.color})`:""," × ",t.quantity]},r))})})]},s.id)),z.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-3 text-gray-400",colSpan:5,children:"Sin pedidos"})})]})]})})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-white/10 rounded p-4 w-full max-w-lg",children:[e.jsx("div",{className:"text-white font-medium mb-3",children:"Editar cliente"}),e.jsxs("form",{onSubmit:async s=>{s.preventDefault();try{(await fetch(`${n}/clients/${T.id}/`,{method:"PATCH",headers:{...o(i),"Content-Type":"application/json"},body:JSON.stringify(h)})).ok&&(S(null),N())}catch{}},className:"space-y-3",children:[e.jsx("input",{value:h.full_name,onChange:s=>g(t=>({...t,full_name:s.target.value})),className:"w-full px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Nombre"}),e.jsx("input",{value:h.cedula,onChange:s=>g(t=>({...t,cedula:s.target.value})),className:"w-full px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Cédula"}),e.jsx("input",{type:"email",value:h.email,onChange:s=>g(t=>({...t,email:s.target.value})),className:"w-full px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Correo"}),e.jsx("textarea",{value:h.address,onChange:s=>g(t=>({...t,address:s.target.value})),className:"w-full px-3 py-2 rounded bg-gray-700 text-white border border-gray-600",rows:3,placeholder:"Dirección"}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>S(null),className:"px-3 py-2 rounded bg-gray-600 hover:bg-gray-700 text-white",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white",children:"Guardar"})]})]})]})})]})};export{X as default};
