import{r as a,j as e}from"./index-DLBiUv4k.js";import"./vendor-BtP0CW_r.js";const T=({token:l,apiBase:g})=>{const[D,k]=a.useState(!1),[o,p]=a.useState(!1),[d,n]=a.useState(null),[s,m]=a.useState(null),[u,b]=a.useState([]),[x,S]=a.useState({username:""});a.useEffect(()=>{try{const t=localStorage.getItem("cashbox_session"),r=localStorage.getItem("cashbox_history");m(t?JSON.parse(t):null),b(r?JSON.parse(r):[])}catch{}},[]);const C=async()=>{try{const t={Authorization:`Bearer ${l}`},r=await fetch(`${g}/users/api/auth/me/`,{headers:t}),y=await r.json();r.ok&&S({username:y.username||""})}catch{}};a.useEffect(()=>{l&&C()},[l]);const _=t=>{const r={started_at:new Date().toISOString(),initial_amount:Number(t||0),user:x.username||""};m(r);try{localStorage.setItem("cashbox_session",JSON.stringify(r))}catch{}n({type:"success",text:"Caja abierta correctamente"}),setTimeout(()=>n(null),3e3)},O=async t=>{if(s){p(!0),n(null);try{const r={Authorization:`Bearer ${l}`},c=await(await fetch(`${g}/sales/list/?page_size=1000`,{headers:r})).json(),L=Array.isArray(c.results)?c.results:Array.isArray(c)?c:[],A=new Date(s.started_at),j=new Date,f=L.filter(h=>{const i=new Date(h.created_at);return i>=A&&i<=j}).reduce((h,i)=>h+Number(i.total_amount||0),0),N=Number(s.initial_amount||0)+f,v=Number(t||0),I=v-N,w=[{started_at:s.started_at,closed_at:j.toISOString(),initial_amount:s.initial_amount,sales_amount:f,expected_amount:N,counted_amount:v,difference:I,user:s.user||x.username||""},...u].slice(0,100);b(w);try{localStorage.setItem("cashbox_history",JSON.stringify(w)),localStorage.removeItem("cashbox_session")}catch{}m(null),n({type:"success",text:"Caja cerrada correctamente"}),setTimeout(()=>n(null),3e3)}catch{n({type:"error",text:"No se pudo cerrar la caja. Intente nuevamente."})}finally{p(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[d&&e.jsx("div",{className:`p-4 rounded-lg text-sm border ${d.type==="success"?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"}`,children:d.text}),e.jsxs("div",{className:"bg-gray-800/50 border border-white/10 rounded-xl p-6 backdrop-blur-sm",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-6 flex items-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-emerald-400",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Gestión de Caja"]}),s?e.jsxs("form",{onSubmit:t=>{t.preventDefault();const r=t.currentTarget.counted.value;O(r),t.currentTarget.reset()},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Hora de Apertura"}),e.jsx("div",{className:"text-white font-mono",children:new Date(s.started_at).toLocaleString()})]}),e.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Usuario Responsable"}),e.jsx("div",{className:"text-white font-medium",children:s.user||x.username})]}),e.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Fondo Inicial"}),e.jsx("div",{className:"text-emerald-400 font-mono text-lg",children:Number(s.initial_amount||0).toLocaleString("es-CO",{style:"currency",currency:"COP"})})]})]}),e.jsxs("div",{className:"max-w-md space-y-4",children:[e.jsx("div",{className:"bg-amber-900/20 border border-amber-500/30 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-amber-200 text-sm",children:"Para cerrar la caja, cuente el dinero físico y digite el total. El sistema calculará las diferencias automáticamente."})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Efectivo en Caja (Contado)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:"$"}),e.jsx("input",{name:"counted",type:"number",step:"0.01",placeholder:"0.00",className:"w-full pl-7 pr-4 py-2.5 rounded-lg bg-gray-900/50 border border-gray-700 text-white focus:ring-2 focus:ring-rose-500 focus:border-transparent outline-none transition-all",required:!0})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full px-4 py-2.5 rounded-lg bg-gradient-to-r from-rose-600 to-rose-500 hover:from-rose-500 hover:to-rose-400 text-white font-medium shadow-lg shadow-rose-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:o?"Cerrando...":"Cerrar Caja"})]})]}):e.jsx("form",{onSubmit:t=>{t.preventDefault();const r=t.currentTarget.initial.value;_(r),t.currentTarget.reset()},className:"max-w-md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-blue-200 text-sm",children:"La caja se encuentra cerrada actualmente. Ingrese el monto inicial para comenzar el turno."})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Fondo Inicial"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:"$"}),e.jsx("input",{name:"initial",type:"number",step:"0.01",placeholder:"0.00",className:"w-full pl-7 pr-4 py-2.5 rounded-lg bg-gray-900/50 border border-gray-700 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",required:!0})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full px-4 py-2.5 rounded-lg bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-medium shadow-lg shadow-emerald-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:o?"Abriendo...":"Abrir Caja"})]})})]}),e.jsxs("div",{className:"bg-gray-800/50 border border-white/10 rounded-xl p-6 backdrop-blur-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Historial de Cierres"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-300",children:[e.jsx("thead",{className:"bg-gray-900/50 text-gray-400 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 rounded-tl-lg",children:"Fecha Apertura"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha Cierre"}),e.jsx("th",{className:"px-4 py-3",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Inicial"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Ventas"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Esperado"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Contado"}),e.jsx("th",{className:"px-4 py-3 rounded-tr-lg text-right",children:"Diferencia"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-gray-500",children:"No hay registros en el historial"})}):u.map((t,r)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:new Date(t.started_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:new Date(t.closed_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:t.user}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-emerald-400",children:Number(t.initial_amount).toLocaleString("es-CO",{style:"currency",currency:"COP"})}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-blue-400",children:Number(t.sales_amount).toLocaleString("es-CO",{style:"currency",currency:"COP"})}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-gray-300",children:Number(t.expected_amount).toLocaleString("es-CO",{style:"currency",currency:"COP"})}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-white",children:Number(t.counted_amount).toLocaleString("es-CO",{style:"currency",currency:"COP"})}),e.jsx("td",{className:`px-4 py-3 text-right font-mono font-medium ${t.difference<0?"text-rose-400":t.difference>0?"text-emerald-400":"text-gray-400"}`,children:Number(t.difference).toLocaleString("es-CO",{style:"currency",currency:"COP"})})]},r))})]})})]})]})};export{T as default};
