import{c as I,r,j as e,e as H,U as R,C as z,T as A,d as U}from"./index-B0-dYYhW.js";import{D as y}from"./dollar-sign-_EJxGbDI.js";import{C as q}from"./circle-alert-CLszRJRx.js";import"./vendor-BtP0CW_r.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],D=I("history",J);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],f=I("wallet",P),Z=({token:c,apiBase:j})=>{const[F,V]=r.useState(!1),[o,N]=r.useState(!1),[d,i]=r.useState(null),[a,g]=r.useState(null),[h,v]=r.useState([]),[p,T]=r.useState({username:""});r.useEffect(()=>{try{const t=localStorage.getItem("cashbox_session"),s=localStorage.getItem("cashbox_history");g(t?JSON.parse(t):null),v(s?JSON.parse(s):[])}catch{}},[]);const $=async()=>{try{const t={Authorization:`Bearer ${c}`},s=await fetch(`${j}/users/api/auth/me/`,{headers:t}),m=await s.json();s.ok&&T({username:m.username||""})}catch{}};r.useEffect(()=>{c&&$()},[c]);const E=t=>{const s={started_at:new Date().toISOString(),initial_amount:Number(t||0),user:p.username||""};g(s);try{localStorage.setItem("cashbox_session",JSON.stringify(s))}catch{}i({type:"success",text:"Caja abierta correctamente"}),setTimeout(()=>i(null),3e3)},L=async t=>{if(a){N(!0),i(null);try{const s={Authorization:`Bearer ${c}`},l=await(await fetch(`${j}/sales/list/?page_size=1000`,{headers:s})).json(),M=Array.isArray(l.results)?l.results:Array.isArray(l)?l:[],O=new Date(a.started_at),w=new Date,_=M.filter(b=>{const u=new Date(b.created_at);return u>=O&&u<=w}).reduce((b,u)=>b+Number(u.total_amount||0),0),S=Number(a.initial_amount||0)+_,C=Number(t||0),B=C-S,k=[{started_at:a.started_at,closed_at:w.toISOString(),initial_amount:a.initial_amount,sales_amount:_,expected_amount:S,counted_amount:C,difference:B,user:a.user||p.username||""},...h].slice(0,100);v(k);try{localStorage.setItem("cashbox_history",JSON.stringify(k)),localStorage.removeItem("cashbox_session")}catch{}g(null),i({type:"success",text:"Caja cerrada correctamente"}),setTimeout(()=>i(null),3e3)}catch{i({type:"error",text:"No se pudo cerrar la caja. Intente nuevamente."})}finally{N(!1)}}},n=t=>{if(t===""||t==null)return"";const s=Number(t);return Number.isNaN(s)?"":s.toLocaleString("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0})},x=({label:t,value:s,icon:m,color:l})=>e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-4 flex items-center justify-between shadow-sm hover:border-gray-700 transition-all group",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs font-medium uppercase tracking-wider mb-1",children:t}),e.jsx("p",{className:"text-2xl font-bold text-white group-hover:scale-105 transition-transform origin-left",children:s})]}),e.jsx("div",{className:`p-3 rounded-lg bg-opacity-10 ${l.bg}`,children:e.jsx(m,{className:`w-6 h-6 ${l.text}`})})]});return e.jsxs("div",{className:"space-y-6 relative animate-in fade-in duration-500",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x,{label:"Estado de Caja",value:a?"ABIERTA":"CERRADA",icon:f,color:a?{bg:"bg-emerald-500",text:"text-emerald-500"}:{bg:"bg-rose-500",text:"text-rose-500"}}),e.jsx(x,{label:"Base Inicial",value:a?n(a.initial_amount):"$0",icon:y,color:{bg:"bg-blue-500",text:"text-blue-500"}}),e.jsx(x,{label:"Hora Apertura",value:a?new Date(a.started_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--",icon:H,color:{bg:"bg-indigo-500",text:"text-indigo-500"}}),e.jsx(x,{label:"Usuario",value:(a==null?void 0:a.user)||p.username||"...",icon:R,color:{bg:"bg-purple-500",text:"text-purple-500"}})]}),d&&e.jsxs("div",{className:`p-4 rounded-xl text-sm flex items-center gap-3 border ${d.type==="success"?"bg-emerald-500/10 text-emerald-400 border-emerald-500/20":"bg-rose-500/10 text-rose-400 border-rose-500/20"}`,children:[d.type==="success"?e.jsx(z,{size:18}):e.jsx(A,{size:18}),d.text]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl overflow-hidden shadow-sm h-full",children:[e.jsxs("div",{className:"p-5 border-b border-gray-800 flex items-center gap-3 bg-gray-900/50",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(f,{className:"w-5 h-5 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Control de Caja"})]}),e.jsx("div",{className:"p-6",children:a?e.jsxs("form",{onSubmit:t=>{t.preventDefault();const s=t.currentTarget.elements.namedItem("counted").value;L(s),t.currentTarget.reset()},className:"space-y-6",children:[e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-xl p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-amber-400 shrink-0"}),e.jsx("p",{className:"text-sm text-amber-200",children:"Para cerrar, cuente el dinero físico. El sistema calculará diferencias."})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-xl border border-gray-700/50 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Inicio:"}),e.jsx("span",{className:"text-white font-mono",children:new Date(a.started_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Base:"}),e.jsx("span",{className:"text-emerald-400 font-mono",children:n(a.initial_amount)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Total Efectivo Contado"}),e.jsxs("div",{className:"relative group",children:[e.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500 group-focus-within:text-rose-500 transition-colors"}),e.jsx("input",{name:"counted",type:"number",step:"0.01",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 bg-gray-800 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-rose-500/50 focus:border-rose-500 transition-all",required:!0})]})]})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full py-3 px-4 bg-rose-600 hover:bg-rose-500 text-white rounded-xl font-medium shadow-lg shadow-rose-900/20 transition-all flex items-center justify-center gap-2",children:[o?"Cerrando...":"Cerrar Turno y Caja",e.jsx(f,{className:"w-4 h-4"})]})]}):e.jsxs("form",{onSubmit:t=>{t.preventDefault();const s=t.currentTarget.elements.namedItem("initial").value;E(s),t.currentTarget.reset()},className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-xl p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-blue-400 shrink-0"}),e.jsx("p",{className:"text-sm text-blue-200",children:"La caja se encuentra cerrada. Ingrese el monto base para iniciar el turno."})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Monto Base Inicial"}),e.jsxs("div",{className:"relative group",children:[e.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500 group-focus-within:text-blue-500 transition-colors"}),e.jsx("input",{name:"initial",type:"number",step:"0.01",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 bg-gray-800 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all",required:!0})]})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full py-3 px-4 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-medium shadow-lg shadow-blue-900/20 transition-all flex items-center justify-center gap-2",children:[o?"Procesando...":"Abrir Turno",e.jsx(U,{className:"w-4 h-4"})]})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl overflow-hidden shadow-sm h-full",children:[e.jsx("div",{className:"p-5 border-b border-gray-800 flex items-center justify-between bg-gray-900/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:e.jsx(D,{className:"w-5 h-5 text-purple-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Historial de Cierres"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-800 bg-gray-800/30",children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Usuario"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right",children:"Base"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right",children:"Ventas"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right",children:"Contado"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right",children:"Diferencia"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx(D,{className:"w-8 h-8 opacity-20"}),e.jsx("p",{children:"No hay registros de cierres aún"})]})})}):h.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-800/30 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-white font-medium",children:new Date(t.closed_at).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.closed_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-300",children:t.user})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("div",{className:"text-sm font-mono text-gray-400",children:n(t.initial_amount)})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("div",{className:"text-sm font-mono text-blue-400",children:n(t.sales_amount)})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("div",{className:"text-sm font-mono text-white",children:n(t.counted_amount)})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:`text-sm font-mono font-bold px-2 py-1 rounded-md inline-block ${t.difference===0?"bg-gray-800 text-gray-400":t.difference>0?"bg-emerald-500/10 text-emerald-400":"bg-rose-500/10 text-rose-400"}`,children:[t.difference>0?"+":"",n(t.difference)]})})]},s))})]})})]})})]})]})};export{Z as default};
