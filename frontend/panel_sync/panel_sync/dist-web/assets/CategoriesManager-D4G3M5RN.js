import{c as I,r as s,j as e,S as B,P as ee,X as te}from"./index-B0-dYYhW.js";import{C as T}from"./circle-check-CX82dJSv.js";import{I as _}from"./image-CpV40QnQ.js";import{C as H}from"./circle-alert-CLszRJRx.js";import{L as ae}from"./layers-Cz3Cg7vt.js";import{T as se}from"./trash-2-DaeEXlCq.js";import"./vendor-BtP0CW_r.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],U=I("folder-open",re);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],le=I("funnel",ie);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],oe=I("pen",ne),be=({token:d,apiBase:o,role:m})=>{const[x,R]=s.useState([]),[u,L]=s.useState(1),[h,ce]=s.useState(10),[P,W]=s.useState(0),[b,q]=s.useState(""),[f,Z]=s.useState("-created_at"),[y,l]=s.useState(null),[G,g]=s.useState(!1),[j,v]=s.useState(""),[N,w]=s.useState(""),[p,C]=s.useState(!0),[i,S]=s.useState(null),[c,k]=s.useState(null),[$,V]=s.useState({}),[X,D]=s.useState(!1),E=t=>({...t?{Authorization:`Bearer ${t}`}:{}}),A=async()=>{l(null),D(!0);try{const t=new URLSearchParams({page:String(u),page_size:String(h)});b&&t.set("search",b),f&&t.set("ordering",f);const a=await fetch(`${o}/products/categories/?${t.toString()}`,{headers:E(d)}),r=await a.json();if(!a.ok)throw new Error(r.detail||"No se pudieron cargar categorías");R(Array.isArray(r.results)?r.results:[]),W(Number(r.count||0))}catch(t){l({type:"error",text:t.message})}finally{D(!1)}};s.useEffect(()=>{d&&A()},[d,u,h,b,f]);const F=()=>{const t={};if(/^[A-Za-z0-9ÁÉÍÓÚáéíóúÑñ\-\s]{1,100}$/.test(j)||(t.name="Nombre requerido, máx 100 y sin caracteres inválidos."),N.length>500&&(t.description="Descripción máximo 500 caracteres."),i){const r=["image/jpeg","image/png","image/webp"].includes(i.type),n=i.size<=5*1024*1024;r||(t.image="Formato de imagen inválido (jpeg, png, webp)."),n||(t.image="Imagen supera 5MB.")}return V(t),Object.keys(t).length===0},J=async t=>{if(t.preventDefault(),l(null),!!F())try{const a=new FormData;a.append("name",j),a.append("description",N),a.append("active",p?"true":"false"),i&&a.append("image",i);const r=await fetch(`${o}/products/categories/`,{method:"POST",headers:E(d),body:a}),n=await r.json();if(!r.ok)throw new Error(n.detail||"No se pudo crear la categoría");l({type:"success",text:"Categoría creada exitosamente"}),g(!1),v(""),w(""),C(!0),S(null),A()}catch(a){l({type:"error",text:a.message})}},K=t=>{k(t),v(t.name||""),w(t.description||""),C(!!t.active),S(null),g(!0)},Q=async t=>{if(t.preventDefault(),l(null),!!F())try{const a=new FormData;a.append("name",j),a.append("description",N),a.append("active",p?"true":"false"),i&&a.append("image",i);const r=await fetch(`${o}/products/categories/${c.id}/`,{method:"PATCH",headers:E(d),body:a}),n=await r.json();if(!r.ok)throw new Error(n.detail||"No se pudo actualizar la categoría");l({type:"success",text:"Categoría actualizada exitosamente"}),g(!1),k(null),v(""),w(""),C(!0),S(null),A()}catch(a){l({type:"error",text:a.message})}},Y=async t=>{if(confirm("¿Estás seguro de eliminar esta categoría?")){l(null);try{const a=await fetch(`${o}/products/categories/${t}/`,{method:"DELETE",headers:E(d)});if(!a.ok){const r=await a.json();throw new Error(r.detail||"No se pudo eliminar")}l({type:"success",text:"Categoría eliminada"}),A()}catch(a){l({type:"error",text:a.message})}}},O=t=>t?t.startsWith("http://")||t.startsWith("https://")?t:t.startsWith("/")?`${o}${t}`:t.startsWith("media/")?`${o}/${t}`:`${o}/media/${t}`:"",M=s.useMemo(()=>Math.max(1,Math.ceil(P/h)),[P,h]),z=({label:t,value:a,icon:r,color:n})=>e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-4 flex items-center justify-between shadow-sm hover:border-gray-700 transition-all",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs font-medium uppercase tracking-wider mb-1",children:t}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a})]}),e.jsx("div",{className:`p-3 rounded-lg bg-opacity-10 ${n.bg}`,children:e.jsx(r,{className:`w-6 h-6 ${n.text}`})})]});return e.jsxs("div",{className:"space-y-6 relative animate-in fade-in duration-500",children:[X&&e.jsx("div",{className:"absolute inset-0 z-50 bg-gray-950/50 backdrop-blur-sm flex items-center justify-center rounded-2xl",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl p-8 shadow-2xl flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin mb-4"}),e.jsx("div",{className:"text-white font-medium",children:"Cargando datos..."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(z,{label:"Total Categorías",value:x.length,icon:U,color:{bg:"bg-blue-500",text:"text-blue-500"}}),e.jsx(z,{label:"Activas",value:x.filter(t=>!!t.active).length,icon:T,color:{bg:"bg-emerald-500",text:"text-emerald-500"}}),e.jsx(z,{label:"Con Imagen",value:x.filter(t=>!!t.image).length,icon:_,color:{bg:"bg-purple-500",text:"text-purple-500"}}),e.jsx(z,{label:"Sin Imagen",value:x.filter(t=>!t.image).length,icon:H,color:{bg:"bg-amber-500",text:"text-amber-500"}})]}),y&&e.jsxs("div",{className:`p-4 rounded-xl text-sm flex items-center gap-3 border ${y.type==="success"?"bg-emerald-500/10 text-emerald-400 border-emerald-500/20":"bg-rose-500/10 text-rose-400 border-rose-500/20"}`,children:[y.type==="success"?e.jsx(T,{size:18}):e.jsx(H,{size:18}),y.text]}),e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-5 border-b border-gray-800 flex flex-col sm:flex-row sm:items-center justify-between gap-4 bg-gray-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Gestión de Categorías"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500 group-focus-within:text-blue-500 transition-colors"}),e.jsx("input",{type:"text",value:b,onChange:t=>{L(1),q(t.target.value)},placeholder:"Buscar categoría...",className:"pl-9 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-xl text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all w-full sm:w-64"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:f,onChange:t=>Z(t.target.value),className:"appearance-none pl-3 pr-8 py-2 bg-gray-800 border border-gray-700 rounded-xl text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 cursor-pointer hover:bg-gray-750 transition-colors",children:[e.jsx("option",{value:"-created_at",children:"Más recientes"}),e.jsx("option",{value:"name",children:"Nombre A-Z"}),e.jsx("option",{value:"-name",children:"Nombre Z-A"}),e.jsx("option",{value:"active",children:"Estado"})]}),e.jsx(le,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-3 h-3 text-gray-500 pointer-events-none"})]}),e.jsxs("button",{onClick:()=>g(!0),disabled:m!=="admin"&&m!=="super_admin",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-xl text-sm font-medium transition-all shadow-lg shadow-blue-900/20 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Nueva"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-800 bg-gray-800/30",children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Categoría"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Imagen"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right",children:"Acciones"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-800",children:[x.map(t=>e.jsxs("tr",{className:"hover:bg-gray-800/30 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-800 border border-gray-700 flex items-center justify-center text-gray-500 font-bold text-sm",children:t.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"font-medium text-white group-hover:text-blue-400 transition-colors",children:t.name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm text-gray-400 max-w-xs truncate",children:t.description||"Sin descripción"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium border ${t.active?"bg-emerald-500/10 text-emerald-400 border-emerald-500/20":"bg-gray-700 text-gray-400 border-gray-600"}`,children:t.active?"Activo":"Inactivo"})}),e.jsx("td",{className:"px-6 py-4",children:t.image?e.jsxs("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-gray-700 relative group/img",children:[e.jsx("img",{src:O(t.image),alt:t.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover/img:opacity-100 transition-opacity cursor-pointer",children:e.jsx(_,{className:"w-4 h-4 text-white"})})]}):e.jsx("span",{className:"text-xs text-gray-600 italic",children:"Sin imagen"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>K(t),disabled:m!=="admin"&&m!=="super_admin",className:"p-2 rounded-lg hover:bg-blue-500/10 text-gray-400 hover:text-blue-400 transition-colors",title:"Editar",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Y(t.id),disabled:m!=="admin"&&m!=="super_admin",className:"p-2 rounded-lg hover:bg-rose-500/10 text-gray-400 hover:text-rose-400 transition-colors",title:"Eliminar",children:e.jsx(se,{className:"w-4 h-4"})})]})})]},t.id)),x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(U,{className:"w-12 h-12 mb-3 opacity-20"}),e.jsx("p",{children:"No se encontraron categorías"})]})})})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-800 flex items-center justify-between bg-gray-900/50",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mostrando página ",e.jsx("span",{className:"font-medium text-white",children:u})," de ",e.jsx("span",{className:"font-medium text-white",children:M})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(t=>Math.max(1,t-1)),disabled:u===1,className:"px-3 py-1.5 rounded-lg border border-gray-700 text-sm text-gray-300 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Anterior"}),e.jsx("button",{onClick:()=>L(t=>Math.min(M,t+1)),disabled:u===M,className:"px-3 py-1.5 rounded-lg border border-gray-700 text-sm text-gray-300 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Siguiente"})]})]})]}),G&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-lg shadow-2xl scale-100 animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:c?"Editar Categoría":"Nueva Categoría"}),e.jsx("button",{onClick:()=>{g(!1),k(null)},className:"text-gray-500 hover:text-white transition-colors",children:e.jsx(te,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:c?Q:J,className:"p-6 space-y-5",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1.5",children:"Nombre"}),e.jsx("input",{type:"text",value:j,onChange:t=>v(t.target.value),required:!0,maxLength:100,className:`w-full px-4 py-2.5 bg-gray-800 border ${$.name?"border-rose-500":"border-gray-700"} rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all`,placeholder:"Ej. Electrónica"}),$.name&&e.jsx("p",{className:"mt-1 text-xs text-rose-400",children:$.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1.5",children:"Descripción"}),e.jsx("textarea",{value:N,onChange:t=>w(t.target.value),maxLength:500,rows:3,className:`w-full px-4 py-2.5 bg-gray-800 border ${$.description?"border-rose-500":"border-gray-700"} rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all resize-none`,placeholder:"Breve descripción de la categoría..."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1.5",children:"Imagen"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:t=>S(t.target.files?t.target.files[0]:null),className:"hidden",id:"cat-image-upload"}),e.jsxs("label",{htmlFor:"cat-image-upload",className:"flex items-center justify-center w-full px-4 py-2.5 bg-gray-800 border border-gray-700 border-dashed rounded-xl text-sm text-gray-400 hover:text-white hover:border-gray-500 cursor-pointer transition-all",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),i?i.name:"Subir imagen"]})]})]}),e.jsx("div",{className:"flex items-center h-full pt-6",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("div",{className:`w-12 h-6 rounded-full p-1 transition-colors duration-200 ease-in-out ${p?"bg-blue-600":"bg-gray-700"}`,children:e.jsx("div",{className:`bg-white w-4 h-4 rounded-full shadow-md transform transition-transform duration-200 ease-in-out ${p?"translate-x-6":"translate-x-0"}`})}),e.jsx("span",{className:"text-sm font-medium text-gray-300 group-hover:text-white transition-colors",children:"Activa"}),e.jsx("input",{type:"checkbox",checked:p,onChange:t=>C(t.target.checked),className:"hidden"})]})})]}),(i||c&&c.image)&&e.jsx("div",{className:"mt-2 relative w-full h-32 bg-gray-800 rounded-xl overflow-hidden border border-gray-700",children:e.jsx("img",{src:i?URL.createObjectURL(i):O(c.image),alt:"Preview",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"pt-4 flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),k(null)},className:"px-4 py-2.5 rounded-xl bg-gray-800 hover:bg-gray-700 text-gray-300 font-medium transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-medium shadow-lg shadow-blue-900/20 transition-all transform hover:scale-[1.02]",children:c?"Guardar Cambios":"Crear Categoría"})]})]})]})})]})};export{be as default};
